<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

        <!--Verze 1.12 - přidání nových tabulek, změna názvů -->
        <changeSet id="12" author="bendik" failOnError="false" runOnChange="true">

            <createTable tableName="arr_data_coordinates">
                <column name="value" type="varchar(250)">
                    <constraints nullable="false"/>
                </column>
                <column name="data_id" type="int">
                    <constraints primaryKey="true"/>
                </column>
            </createTable>

            <createTable tableName="arr_data_record_ref">
                <column name="position" type="int"/>
                <column name="data_id" type="int">
                    <constraints primaryKey="true"/>
                </column>
                <column name="record_id" type="int">
                    <constraints nullable="false"/>
                </column>
            </createTable>

            <createTable tableName="arr_data_party_ref">
                <column name="position" type="int"/>
                <column name="data_id" type="int">
                    <constraints primaryKey="true"/>
                </column>
                <column name="abstract_party_id" type="int">
                    <constraints nullable="false"/>
                </column>
            </createTable>

            <renameTable oldTableName="arr_data_reference" newTableName="arr_data_unitid" />
            <renameTable oldTableName="arr_data_datace" newTableName="arr_data_unitdate" />

            <addColumn tableName="rul_desc_item_type">
                <column name="fa_only" type="boolean"/>
            </addColumn>

            <addForeignKeyConstraint constraintName="fk_dataCoordinates_data"
                                     baseTableName="arr_data_coordinates"
                                     baseColumnNames="data_id"
                                     referencedTableName="arr_data"
                                     referencedColumnNames="data_id"
                                     onDelete="NO ACTION"/>

            <addForeignKeyConstraint constraintName="fk_dataRecordRef_data"
                                     baseTableName="arr_data_record_ref"
                                     baseColumnNames="data_id"
                                     referencedTableName="arr_data"
                                     referencedColumnNames="data_id"
                                     onDelete="NO ACTION"/>

            <addForeignKeyConstraint constraintName="fk_dataRecordRef_record"
                                     baseTableName="arr_data_record_ref"
                                     baseColumnNames="record_id"
                                     referencedTableName="reg_record"
                                     referencedColumnNames="record_id"
                                     onDelete="NO ACTION"/>

            <addForeignKeyConstraint constraintName="fk_dataPartyRef_data"
                                     baseTableName="arr_data_party_ref"
                                     baseColumnNames="data_id"
                                     referencedTableName="arr_data"
                                     referencedColumnNames="data_id"
                                     onDelete="NO ACTION"/>

            <addForeignKeyConstraint constraintName="fk_dataPartyRef_abstractParty"
                                     baseTableName="arr_data_party_ref"
                                     baseColumnNames="abstract_party_id"
                                     referencedTableName="par_abstract_party"
                                     referencedColumnNames="abstract_party_id"
                                     onDelete="NO ACTION"/>


        </changeSet>


</databaseChangeLog>
