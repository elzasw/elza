<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="31" author="slapa">
    	<validCheckSum>7:07c8123fc6d2ceeef4dbeefb1f739885</validCheckSum>
        <createView viewName="usr_permission_view">
            SELECT DISTINCT
                p.permission_id AS id,
                p.permission,
                CASE WHEN p.user_id IS NULL THEN gu.user_id ELSE p.user_id END AS user_id,
                p.fund_id,
                p.scope_id
            FROM
                usr_permission p
            LEFT JOIN
                usr_user u ON p.user_id = u.user_id
            LEFT JOIN
                usr_group_user gu ON gu.group_id = p.group_id
        </createView>
    </changeSet>

</databaseChangeLog>