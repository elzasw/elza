<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="20180206152200" author="fric">
        <renameTable oldTableName="reg_register_type" newTableName="ap_type"/>
        <renameTable oldTableName="reg_variant_record" newTableName="ap_variant_record"/>
        <renameTable oldTableName="reg_record" newTableName="ap_record"/>
        <renameTable oldTableName="reg_scope" newTableName="ap_scope"/>
        <renameTable oldTableName="reg_external_system" newTableName="ap_external_system"/>
    </changeSet>

    <changeSet id="20180213105500" author="fric">
        <renameColumn newColumnName="ap_type_id" oldColumnName="register_type_id" tableName="ap_type"/>
        <renameColumn newColumnName="parent_ap_type_id" oldColumnName="parent_register_type_id" tableName="ap_type"/>
        <renameColumn newColumnName="ap_type_id" oldColumnName="register_type_id" tableName="par_registry_role"/>
        <renameColumn newColumnName="ap_type_id" oldColumnName="register_type_id" tableName="ap_record"/>
        <renameColumn newColumnName="ap_type_id" oldColumnName="register_type_id" tableName="rul_item_spec_register"/>
    </changeSet>

    <changeSet id="20180213110800" author="fric">
        <dropForeignKeyConstraint baseTableName="ap_record" constraintName="fk_record_regRegisterType"/>
        <dropForeignKeyConstraint baseTableName="ap_record" constraintName="fk_reg_external_system"/>
        <dropForeignKeyConstraint baseTableName="ap_type" constraintName="fk_reg_register_type_package"/>
        <dropForeignKeyConstraint baseTableName="par_registry_role" constraintName="fk_register_type_id"/>
        <dropForeignKeyConstraint baseTableName="ap_type" constraintName="fk_regRegisterType_parPartyType"/>
        <dropForeignKeyConstraint baseTableName="ap_type" constraintName="fk_regRegisterType_regRegisterType"/>

        <dropForeignKeyConstraint baseTableName="par_party" constraintName="fk_party_regRecord"/>
        <dropForeignKeyConstraint baseTableName="ap_variant_record" constraintName="fk_variantRecord_regRecord"/>
        <dropForeignKeyConstraint baseTableName="arr_data_record_ref" constraintName="fk_dataRecordRef_record"/>
        <dropForeignKeyConstraint baseTableName="arr_node_register" constraintName="fk_nodeRegister_record"/>
        <dropForeignKeyConstraint baseTableName="par_relation_entity" constraintName="fk_parRelationEntity_regRecord"/>

        <dropForeignKeyConstraint baseTableName="rul_item_spec_register" constraintName="fk_rulDescItemSpecRegister_registerType"/>

        <dropForeignKeyConstraint baseTableName="arr_fund_register_scope" constraintName="fk_faRegScope_scope"/>
        <dropForeignKeyConstraint baseTableName="ap_record" constraintName="fk_record_scope"/>
        <dropForeignKeyConstraint baseTableName="usr_permission" constraintName="fk_permission_scope"/>
        <dropForeignKeyConstraint baseTableName="ap_external_system" constraintName="fk_sys_external_system"/>

        <dropPrimaryKey tableName="ap_external_system"/>
        <dropPrimaryKey tableName="ap_record"/>
        <dropPrimaryKey tableName="ap_type"/>
        <dropPrimaryKey tableName="ap_scope"/>
        <dropPrimaryKey tableName="ap_variant_record"/>

        <addPrimaryKey columnNames="variant_record_id" constraintName="pk_ap_variant_record" tableName="ap_variant_record"/>
        <addPrimaryKey columnNames="scope_id" constraintName="pk_ap_scope" tableName="ap_scope"/>
        <addPrimaryKey columnNames="ap_type_id" constraintName="pk_ap_type" tableName="ap_type"/>
        <addPrimaryKey columnNames="record_id" constraintName="pk_ap_record" tableName="ap_record"/>
        <addPrimaryKey columnNames="external_system_id" constraintName="pk_ap_external_system" tableName="ap_external_system"/>

        <addForeignKeyConstraint baseColumnNames="external_system_id" baseTableName="ap_external_system"
                                 constraintName="fk_sys_external_system" referencedColumnNames="external_system_id"
                                 referencedTableName="sys_external_system"/>
        <addForeignKeyConstraint baseColumnNames="ap_type_id" baseTableName="ap_record"
                                 constraintName="fk_accessPoint_apType" referencedColumnNames="ap_type_id"
                                 referencedTableName="ap_type"/>
        <addForeignKeyConstraint baseColumnNames="external_system_id" baseTableName="ap_record"
                                 constraintName="fk_ap_external_system" referencedColumnNames="external_system_id"
                                 referencedTableName="ap_external_system"/>
        <addForeignKeyConstraint baseColumnNames="package_id" baseTableName="ap_type"
                                 constraintName="fk_ap_type_package" referencedColumnNames="package_id"
                                 referencedTableName="rul_package"/>
        <addForeignKeyConstraint baseColumnNames="ap_type_id" baseTableName="par_registry_role"
                                 constraintName="fk_ap_type_id" referencedColumnNames="ap_type_id"
                                 referencedTableName="ap_type"/>
        <addForeignKeyConstraint baseColumnNames="party_type_id" baseTableName="ap_type"
                                 constraintName="fk_apType_parPartyType" referencedColumnNames="party_type_id"
                                 referencedTableName="par_party_type"/>
        <addForeignKeyConstraint baseColumnNames="parent_ap_type_id" baseTableName="ap_type"
                                 constraintName="fk_apType_apType"
                                 referencedColumnNames="ap_type_id" referencedTableName="ap_type"/>
        <addForeignKeyConstraint baseColumnNames="record_id" baseTableName="par_party"
                                 constraintName="fk_party_apRecord" referencedColumnNames="record_id"
                                 referencedTableName="ap_record"/>
        <addForeignKeyConstraint baseColumnNames="record_id" baseTableName="ap_variant_record"
                                 constraintName="fk_variantRecord_regRecord" referencedColumnNames="record_id"
                                 referencedTableName="ap_record"/>
        <addForeignKeyConstraint baseColumnNames="record_id" baseTableName="arr_data_record_ref"
                                 constraintName="fk_dataRecordRef_record" referencedColumnNames="record_id"
                                 referencedTableName="ap_record"/>
        <addForeignKeyConstraint baseColumnNames="record_id" baseTableName="arr_node_register"
                                 constraintName="fk_nodeRegister_record" referencedColumnNames="record_id"
                                 referencedTableName="ap_record"/>
        <addForeignKeyConstraint baseColumnNames="record_id" baseTableName="par_relation_entity"
                                 constraintName="fk_parRelationEntity_regRecord" referencedColumnNames="record_id"
                                 referencedTableName="ap_record"/>
        <addForeignKeyConstraint baseColumnNames="ap_type_id" baseTableName="rul_item_spec_register"
                                 constraintName="fk_rulDescItemSpecRegister_apType" referencedColumnNames="ap_type_id"
                                 referencedTableName="ap_type"/>
        <addForeignKeyConstraint baseColumnNames="scope_id" baseTableName="arr_fund_register_scope"
                                 constraintName="fk_faApScope_scope" referencedColumnNames="scope_id"
                                 referencedTableName="ap_scope"/>
        <addForeignKeyConstraint baseColumnNames="scope_id" baseTableName="ap_record"
                                 constraintName="fk_record_scope" referencedColumnNames="scope_id"
                                 referencedTableName="ap_scope"/>
        <addForeignKeyConstraint baseColumnNames="scope_id" baseTableName="usr_permission"
                                 constraintName="fk_permission_scope" referencedColumnNames="scope_id"
                                 referencedTableName="ap_scope"/>

        <update tableName="db_hibernate_sequences">
            <column name="sequence_name" value="ap_type|ap_type_id" />
            <where>sequence_name = 'reg_register_type|register_type_id'</where>
        </update>

        <update tableName="db_hibernate_sequences">
            <column name="sequence_name" value="ap_scope|scope_id" />
            <where>sequence_name = 'reg_scope|scope_id'</where>
        </update>
    </changeSet>


    <changeSet id="20180205152600" author="fric">
        <addColumn tableName="ap_scope">
            <column name="language" type="nvarchar(3)"/>
        </addColumn>
    </changeSet>

    <changeSet id="20180205153600" author="fric">
        <createTable tableName="ap_language">
            <column name="language_id" type="int">
                <constraints primaryKey="true"/>
            </column>
            <column name="code" type="nvarchar(3)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="nvarchar(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="20180205154400" author="fric">
        <insert tableName="ap_language">
            <column name="language_id">0</column>
            <column name="code">cze</column>
            <column name="name">čeština</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">1</column>
            <column name="code">eng</column>
            <column name="name">angličtina</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">2</column>
            <column name="code">ger</column>
            <column name="name">němčina</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">3</column>
            <column name="code">rus</column>
            <column name="name">ruština</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">4</column>
            <column name="code">lat</column>
            <column name="name">latina</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">5</column>
            <column name="code">slo</column>
            <column name="name">slovenština</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">6</column>
            <column name="code">pol</column>
            <column name="name">polština</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">7</column>
            <column name="code">ita</column>
            <column name="name">italština</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">8</column>
            <column name="code">fre</column>
            <column name="name">francouzština</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">9</column>
            <column name="code">spa</column>
            <column name="name">španělština</column>
        </insert>

        <insert tableName="ap_language">
            <column name="language_id">10</column>
            <column name="code">heb</column>
            <column name="name">hebrejština</column>
        </insert>
    </changeSet>

    <changeSet id="20180404152900" author="vanek">
        <addColumn tableName="arr_bulk_action_run">
            <column name="config" type="${type.text}"/>
        </addColumn>
    </changeSet>
</databaseChangeLog>
