<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <!-- Verze 1.3 - přidání vazební tabulky rul_desc_item_spec_register -->
    <changeSet id="4" author="vavrejn">

        <createTable tableName="rul_desc_item_spec_register">
            <column name="desc_item_spec_register_id" type="int">
                <constraints primaryKey="true" />
            </column>
            <column name="register_type_id" type="int">
                <constraints nullable="false" />
            </column>
            <column name="desc_item_spec_id" type="int">
                <constraints nullable="false" />
            </column>
        </createTable>

        <addForeignKeyConstraint
            constraintName="fk_rulDescItemSpecRegister_registerType"
            baseTableName="rul_desc_item_spec_register" baseColumnNames="register_type_id"
            referencedTableName="reg_register_type"
            referencedColumnNames="register_type_id" onDelete="NO ACTION" />

        <addForeignKeyConstraint
            constraintName="fk_rulDescItemSpecRegister_descItemSpec"
            baseTableName="rul_desc_item_spec_register" baseColumnNames="desc_item_spec_id"
            referencedTableName="rul_desc_item_spec"
            referencedColumnNames="desc_item_spec_id" onDelete="NO ACTION" />

        <!-- migrace dat -->
        <customChange class="cz.tacr.elza.dbchangelog.DbUpgrade1_3">
        </customChange>

        <dropForeignKeyConstraint baseTableName="rul_desc_item_spec" constraintName="fk_itmSpec_regType"/>
        <dropColumn columnName="register_type_id" tableName="rul_desc_item_spec" />
    </changeSet>

</databaseChangeLog>
