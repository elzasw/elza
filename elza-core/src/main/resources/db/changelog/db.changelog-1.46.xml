<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="47" author="slapa">
        <validCheckSum>7:5801a38b823b9614a3d1da7f2adb0a54</validCheckSum>

        <createTable tableName="arr_item_settings">
            <column name="item_settings_id" type="int">
                <constraints primaryKey="true"/>
            </column>
            <column name="item_type_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="output_definition_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="block_action_result" type="boolean">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="fk_itemSettings_item_type"
                                 baseTableName="arr_item_settings"
                                 baseColumnNames="item_type_id"
                                 referencedTableName="rul_item_type"
                                 referencedColumnNames="item_type_id"
                                 onDelete="NO ACTION"/>

        <addForeignKeyConstraint constraintName="fk_itemSettings_output_definition"
                                 baseTableName="arr_item_settings"
                                 baseColumnNames="output_definition_id"
                                 referencedTableName="arr_output_definition"
                                 referencedColumnNames="output_definition_id"
                                 onDelete="NO ACTION"/>



        <createTable tableName="rul_action_recommended">
            <column name="action_recommended_id" type="int">
                <constraints primaryKey="true"/>
            </column>
            <column name="action_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="output_type_id" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="fk_actionRecommended_action"
                                 baseTableName="rul_action_recommended"
                                 baseColumnNames="action_id"
                                 referencedTableName="rul_action"
                                 referencedColumnNames="action_id"
                                 onDelete="NO ACTION"/>

        <addForeignKeyConstraint constraintName="fk_actionRecommended_output_type"
                                 baseTableName="rul_action_recommended"
                                 baseColumnNames="output_type_id"
                                 referencedTableName="rul_output_type"
                                 referencedColumnNames="output_type_id"
                                 onDelete="NO ACTION"/>


        <createTable tableName="rul_item_type_action">
            <column name="item_type_action_id" type="int">
                <constraints primaryKey="true"/>
            </column>
            <column name="action_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="item_type_id" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="fk_itemTypeAction_action"
                                 baseTableName="rul_item_type_action"
                                 baseColumnNames="action_id"
                                 referencedTableName="rul_action"
                                 referencedColumnNames="action_id"
                                 onDelete="NO ACTION"/>

        <addForeignKeyConstraint constraintName="fk_itemType_action"
                                 baseTableName="rul_item_type_action"
                                 baseColumnNames="item_type_id"
                                 referencedTableName="rul_item_type"
                                 referencedColumnNames="item_type_id"
                                 onDelete="NO ACTION"/>


        <addColumn tableName="arr_bulk_action_run">
            <column name="output_definition_id" type="int" />
            <column name="result" type="text" />
        </addColumn>

        <addForeignKeyConstraint constraintName="fk_bulkActionRun_output_definition"
                                 baseTableName="arr_bulk_action_run"
                                 baseColumnNames="output_definition_id"
                                 referencedTableName="arr_output_definition"
                                 referencedColumnNames="output_definition_id"
                                 onDelete="NO ACTION"/>

    </changeSet>

</databaseChangeLog>
