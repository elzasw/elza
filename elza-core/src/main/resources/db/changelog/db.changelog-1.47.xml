<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="48" author="compel">
        <addColumn tableName="arr_output_definition">
            <column type="CHAR(12)" name="state" afterColumn="name">
                <constraints nullable="true"/>
            </column>
            <column type="nvarchar(1000)" name="error" afterColumn="state">
                <constraints nullable="true"/>
            </column>
        </addColumn>
        <update tableName="arr_output_definition">
            <column name="state" value="FINISHED" />
            <where>(SELECT arr_output_result.output_result_id from arr_output_result where arr_output_result.output_definition_id = arr_output_definition.output_definition_id) IS NOT NULL</where>
        </update>
        <update tableName="arr_output_definition">
            <column name="state" value="OPEN" />
            <where>(SELECT arr_output_result.output_result_id from arr_output_result where arr_output_result.output_definition_id = arr_output_definition.output_definition_id) IS NULL</where>
        </update>
        <addNotNullConstraint tableName="arr_output_definition" columnName="state" columnDataType="CHAR(12)" />
    </changeSet>

</databaseChangeLog>
