<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <!-- Verze 1.8 - přidání typů atributu pro typ UNITDATE a STRING -->
    <changeSet id="9" author="slapa">

        <!-- dočasné odstranení unikátnosti -->
        <dropUniqueConstraint constraintName="rul_desc_item_type_view_order_key"
                              tableName="rul_desc_item_type" />

        <sql splitStatements="true" stripComments="true">
            UPDATE rul_desc_item_type SET view_order = view_order + 3 WHERE view_order > 6;
            UPDATE rul_desc_item_type SET view_order = view_order + 1 WHERE view_order = 6;
        </sql>

        <!-- zpětné přidání unikátnosti -->
        <addUniqueConstraint columnNames="view_order"
                             constraintName="rul_desc_item_type_view_order_key"
                             tableName="rul_desc_item_type" />

        <insert tableName="rul_desc_item_type">
            <column name="desc_item_type_id" value="49"/>
            <column name="data_type_id" value="4"/>
            <column name="code" value="ZP2015_UNIT_DATE_PRE"/>
            <column name="name" value="Datace prior vzniku jednotky popisu - strojově čitelný"/>
            <column name="shortcut" value="Dat. vzniku - prior"/>
            <column name="description" value="ZP4.2.5 Datace vzniku jednotky popisu - strojově čitelný"/>
            <column name="is_value_unique" value="false"/>
            <column name="can_be_ordered" value="false"/>
            <column name="use_specification" value="false"/>
            <column name="view_order" value="6"/>
            <column name="fa_only" value="false"/>
        </insert>

        <insert tableName="rul_desc_item_type">
            <column name="desc_item_type_id" value="50"/>
            <column name="data_type_id" value="4"/>
            <column name="code" value="ZP2015_UNIT_DATE_POST"/>
            <column name="name" value="Datace posterior vzniku jednotky popisu - strojově čitelný"/>
            <column name="shortcut" value="Dat. vzniku - posterior"/>
            <column name="description" value="ZP4.2.5 Datace vzniku jednotky popisu - strojově čitelný"/>
            <column name="is_value_unique" value="false"/>
            <column name="can_be_ordered" value="false"/>
            <column name="use_specification" value="false"/>
            <column name="view_order" value="8"/>
            <column name="fa_only" value="false"/>
        </insert>

        <insert tableName="rul_desc_item_type">
            <column name="desc_item_type_id" value="51"/>
            <column name="data_type_id" value="2"/>
            <column name="code" value="ZP2015_DATE_TEXT"/>
            <column name="name" value="Datace vzniku jednotky popisu - textový zápis"/>
            <column name="shortcut" value="Dat. vzniku - textově"/>
            <column name="description" value="ZP4.2.5 Datace vzniku jednotky popisu - textový zápis"/>
            <column name="is_value_unique" value="false"/>
            <column name="can_be_ordered" value="false"/>
            <column name="use_specification" value="false"/>
            <column name="view_order" value="9"/>
            <column name="fa_only" value="false"/>
        </insert>

        <update tableName="db_hibernate_sequences">
            <column name="next_val" value="52"/>
            <where>sequence_name = 'rul_desc_item_type|desc_item_type_id'</where>
        </update>

    </changeSet>

</databaseChangeLog>
