<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <!-- Verze 1.4 - pridani tabulky arr_calendar_type; smazani soucasnych dat v arr_data_unitdate; upraveni tabulky arr_data_unitdate -->
    <changeSet id="5" author="slapa">

        <createTable tableName="arr_calendar_type">
            <column name="calendar_type_id" type="int">
                <constraints primaryKey="true" />
            </column>
            <column name="code" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="varchar(250)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <insert tableName="arr_calendar_type">
            <column name="calendar_type_id" value="1"/>
            <column name="code" value="GREGORIAN"/>
            <column name="name" value="Gregoriánský"/>
        </insert>

        <insert tableName="arr_calendar_type">
            <column name="calendar_type_id" value="2"/>
            <column name="code" value="JULIAN"/>
            <column name="name" value="Juliánský"/>
        </insert>

        <!-- odstraneni soucasnych dat pro dataci -->
        <sql dbms="postgresql" splitStatements="true" stripComments="true">
            DELETE FROM arr_data_unitdate;
            DELETE FROM arr_data WHERE data_type_id = 4;
            DELETE FROM arr_desc_item WHERE desc_item_type_id = 6;
        </sql>

        <addColumn tableName="arr_data_unitdate">
            <column name="calendar_type_id" type="int">
                <constraints nullable="false" />
            </column>
            <column name="value_from" type="varchar(19)">
                <constraints nullable="true" />
            </column>
            <column name="value_from_estimated" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="value_to" type="varchar(19)" >
                <constraints nullable="true" />
            </column>
            <column name="value_to_estimated" type="boolean">
                <constraints nullable="false"/>
            </column>
        </addColumn>

        <dropColumn columnName="value" tableName="arr_data_unitdate" />

        <addForeignKeyConstraint
                constraintName="fk_arrDataUnitdate_calendarType"
                baseTableName="arr_data_unitdate" baseColumnNames="calendar_type_id"
                referencedTableName="arr_calendar_type"
                referencedColumnNames="calendar_type_id" onDelete="NO ACTION" />


    </changeSet>

</databaseChangeLog>
