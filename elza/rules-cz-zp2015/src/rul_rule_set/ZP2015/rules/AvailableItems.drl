package ZP2015;

import cz.tacr.elza.domain.RulItemSpec;
import cz.tacr.elza.domain.RulItemTypeExt;
import cz.tacr.elza.domain.RulItemSpecExt;
import cz.tacr.elza.drools.model.AvailableDescItems;
import cz.tacr.elza.drools.model.ActiveLevel;
import cz.tacr.elza.drools.model.Level;
import cz.tacr.elza.drools.model.DescItem;
import cz.tacr.elza.drools.model.StructObjItem;

import java.util.Arrays;
import java.util.Set;
import cz.tacr.elza.domain.RulItemType;

// Jak psát pravidla:
// vyšší saliance (100) - vyhodnocuje se jako první a obsahu obecné předpoklady, např. neopakovatelnost apod.
// standardní úroveň - vyhodnocuje se obvykle možnost prvku popisu
// nižší saliance (-100) - vyhodnocováno po možnosti prvku popisu, obsahuje informaci o povinnosti

//
// Otazky:
// - Jak pridat kopii prvku? Jde o to mit moznost postupne pridavat
//   dostupne specifikace samostatnymi pravidly
// Priklad:
// - addWithAllSpec
// - addWithoutSpec - ?kde je vzit pozdeji?

rule "Prvky popisu lze nastavit na Nezjištěno"
salience 100
no-loop
when
    $itemType : RulItemTypeExt(code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF",
        // ZP5.2.3 Způsob a forma dochování
        "ZP2015_STORAGE_COND",
        // ZP5.2.4 Rozměry, hmotnost, velikost, množství
        "ZP2015_SIZE",
        // ZP5.2.4 Šířka / Průměr
        "ZP2015_SIZE_WIDTH",
        // ZP5.2.4 Výška
        "ZP2015_SIZE_HEIGHT",
        // ZP5.2.4 Hloubka
        "ZP2015_SIZE_DEPTH",
        // ZP5.2.5 Měřítko
        "ZP2015_SCALE",
		"ZP2015_SCALE_NUMERICAL",
        // ZP5.2.6 Souřadnice - tvar a souřadnice
        "ZP2015_POSITION",
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT",        
        // ZP5.2.8 Technika záznamu
        "ZP2015_ITEM_MAT_TECHNIKA",
        // ZP5.2.8 Adjustace nosiče záznamu
        "ZP2015_ITEM_MAT_ADJUSTACE",
        // ZP5.2.8 Nosič záznamu
        "ZP2015_ITEM_MAT_NOSIC",
        // ZP5.2.8 Látka záznamu
        "ZP2015_ITEM_MAT_LATKA_ZAZNAMU",
        // ZP5.2.10 Jazyk
        "ZP2015_LANGUAGE",
        // ZP5.7.1 Opis, nápis, exerque
        "ZP2015_EXERQUE",
        // ZP5.7.2 Popis obrazu v poli typáře či otisku
        "ZP2015_PAINTING_CHAR",
        // ZP5.7.3 Koroborace dokumentu, k němuž byl popisovaný otisk připojen
        "ZP2015_CORROBORATION",
        // ZP5.7.4 Počet otisků původní a současný
        "ZP2015_IMPRINT_COUNT",
        // ZP5.7.5 Pořadí otisku
        "ZP2015_IMPRINT_ORDER",
        // ZP5.11.1 Legenda
        "ZP2015_LEGEND",
        // ZP5.13.1 Délka filmového záznamu
        "ZP2015_MOVIE_LENGTH",
        // ZP5.14.1 Délka zvukového záznamu
        "ZP2015_RECORD_LENGTH",
        // ZP5.3-5.23 Role entit
        "ZP2015_ENTITY_ROLE"))
then
    $itemType.setIndefinable(true);
end

rule "Nastaveni vychozi urovne pro chyby u prvku popisu"
salience 100
no-loop
when
  $itemType : RulItemTypeExt()
then
  $itemType.setPolicyTypeCode("ZP2015_POL_BASIC");
end

rule "Nastaveni vychozi urovne pro chyby u specifikaci"
salience 100
no-loop
when
  $itemType : RulItemTypeExt()
  $itemSpec : RulItemSpecExt() from $itemType.rulItemSpecList
then
  $itemSpec.setPolicyTypeCode("ZP2015_POL_BASIC");
end

// Nastaveni vychozi neopakovatelnosti atributu
rule "U atributu je zapotrebi nove explicitne nastavit neopakovatelnost"
salience 100
no-loop
when
    $itemType : RulItemTypeExt(code in ("ZP2015_ARRANGEMENT_TYPE", "ZP2015_LEVEL_TYPE", "ZP2015_FOLDER_TYPE",
        "ZP2015_UNIT_TYPE", "ZP2015_UNIT_SUBTYPE", "ZP2015_UNIT_COUNT", "ZP2015_UNIT_ID", 
        "ZP2015_SERIAL_NUMBER", "ZP2015_TITLE", "ZP2015_TITLE_PUBLIC", "ZP2015_STORAGE_ID", "ZP2015_AIP_ID", 
        "ZP2015_FORMAL_TITLE", "ZP2015_UNIT_DATE", "ZP2015_UNIT_DATE_BULK",
        "ZP2015_UNIT_DATE_TEXT", "ZP2015_UNIT_HIST", "ZP2015_UNIT_ARR", "ZP2015_UNIT_CONTENT",
        "ZP2015_UNIT_SOURCE", "ZP2015_FUTURE_UNITS", "ZP2015_UNIT_ACCESS", "ZP2015_UNIT_INFO_RIGHTS",
        "ZP2015_UNIT_COPY_RIGHTS", "ZP2015_UNIT_CURRENT_STATUS", "ZP2015_COPY_SOURCE",
        "ZP2015_RELATED_UNITS", "ZP2015_EXISTING_COPY", "ZP2015_ARRANGEMENT_INFO",
        "ZP2015_INTERNAL_NOTE", "ZP2015_NOTE",
        "ZP2015_ARRANGE_RULES", "ZP2015_STORAGE_COND", "ZP2015_SIZE",
        "ZP2015_SIZE_WIDTH", "ZP2015_SIZE_HEIGHT", "ZP2015_SIZE_DEPTH", "ZP2015_SIZE_UNITS", 
        "ZP2015_SCALE","ZP2015_SCALE_NUMERICAL",
        "ZP2015_ORIENTATION", "ZP2015_ITEM_MAT", "ZP2015_PART", "ZP2015_EDITION",
        "ZP2015_EXERQUE", "ZP2015_PAINTING_CHAR", "ZP2015_CORROBORATION", "ZP2015_IMPRINT_COUNT",
        "ZP2015_IMPRINT_ORDER", "ZP2015_LEGEND", "ZP2015_MOVIE_LENGTH", "ZP2015_RECORD_LENGTH",
        "ZP2015_COLL_EXTENT_LENGTH", "ZP2015_DESCRIPTION_DATE","ZP2015_PUBLISHED",
        "ZP2015_WRITING",
        "ZP2015_INVALID_RECORD",
        // nastaveni pro ulozeni
        "ZP2015_PACKET_TYPE", "ZP2015_PACKET_FIXED_PREFIX", "ZP2015_PACKET_PREFIX",
        "ZP2015_PACKET_NUMBER", "ZP2015_PACKET_POSTFIX", "ZP2015_ITEM_LINK"
        ))
then
    $itemType.setRepeatable(false);
end

rule "ReadOnly prvky popisu jsou možné (byly převzaty odjinud)"
no-loop
when
    $activeLevel : ActiveLevel( )
    $item: DescItem( readOnly ) from $activeLevel.ownDescItems
    $itemType : RulItemTypeExt(code == $item.type && type==RulItemType.Type.IMPOSSIBLE )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

//
// Hierarchie popisu
//
rule "HP_001 Každá jednotka popisu musí mít uvedenu úroveň popisu"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end


rule "HP_002 Úroveň archivní soubor se vždy na kořeni"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent==null )
    $itemSpec : RulItemSpecExt(code == "ZP2015_LEVEL_ROOT") from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end

// HP_003 Úroveň série se použije pod kořenem nebo jinou sérií
rule "HP_003_01 Úroveň série se použije pod kořenem nebo dílčím listem"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ROOT", "ZP2015_LEVEL_SECTION") ) from $parentDescItems
    $itemSpec : RulItemSpecExt(code == "ZP2015_LEVEL_SERIES") from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "HP_003_02 Pokud je rodic série a ma sourozence pred typu serie, tak je serie"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems && siblingBefore!=null && $siblingDescItems: siblingBefore.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES" ) from $parentDescItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES") from $siblingDescItems
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_SERIES")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end

rule "HP_003_03 Pokud je rodic série a je první potomek a sourozenec za typu serie, tak je serie"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems && siblingBefore==null && 
                                 siblingAfter!=null && $siblingDescItems: siblingAfter.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES" ) from $parentDescItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES") from $siblingDescItems
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_SERIES")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end

rule "HP_003_04 Rodic serie a nema sourozence - muze byt serie"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems && siblingBefore==null && siblingAfter==null )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES" ) from $parentDescItems
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_SERIES")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end


// HP_004 Složka nebo jednotlivost pod sérií
rule "HP_004_01 Složka nebo jednotlivost pod sérií - rodic serie a nema sourozence"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems && siblingBefore==null && siblingAfter==null )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES" ) from $parentDescItems
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "HP_004_02 Složka nebo jednotlivost pod sérií - rodic série a ma sourozence pred typu slozka nebo jednotlivost"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems && siblingBefore!=null && $siblingDescItems: siblingBefore.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES" ) from $parentDescItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM")) from $siblingDescItems
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "HP_004_03 Složka nebo jednotlivost pod sérií - rodic série, je první potomek a ma sourozence za typu slozka nebo jednotlivost"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems && siblingBefore==null && 
                                 siblingAfter!=null && $siblingDescItems: siblingAfter.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES" ) from $parentDescItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM")) from $siblingDescItems
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

// HP_005 Chybějící typ úrovně sourozence pod sérií
rule "HP_005_01 Chybějící typ úrovně sourozence pod sérií - sourozence za bez typu"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems && siblingAfter!=null && $siblingDescItems: siblingAfter.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES" ) from $parentDescItems
    not(DescItem(type=="ZP2015_LEVEL_TYPE" ) from $siblingDescItems )
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_SERIES", "ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "HP_005_02 Chybějící typ úrovně sourozence pod sérií - sourozence za bez typu"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems && siblingBefore!=null && $siblingDescItems: siblingBefore.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_SERIES" ) from $parentDescItems
    not(DescItem(type=="ZP2015_LEVEL_TYPE" ) from $siblingDescItems )
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_SERIES", "ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

// HP_006 Složka musí mít uveden typ složky
rule "HP_006 Složka musí mít uveden typ složky"
no-loop
when
    $activeLevel : ActiveLevel( parent!=null  )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.ownDescItems
    $itemType : RulItemTypeExt(code == "ZP2015_FOLDER_TYPE")
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

rule "HP_007 Složka může být vždy typu logická"
no-loop
when
    $activeLevel : ActiveLevel( parent!=null  )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_FOLDER_TYPE")
    $itemSpec : RulItemSpecExt(code == "ZP2015_FOLDER_LOGICAL" ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end


// HP_008 Způsob pořádání lze nastavit do úrovně složka
rule "HP_008_01 Způsob pořádání lze nastavit do úrovně složka - prvek popisu"
no-loop
when
  $activeLevel : ActiveLevel( )
  DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ROOT", "ZP2015_LEVEL_SECTION", "ZP2015_LEVEL_SERIES", "ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
  $itemType : RulItemTypeExt(code == "ZP2015_ARRANGEMENT_TYPE")
then
  $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "HP_008_02 Způsob pořádání lze nastavit do úrovně složka - specifikace"
no-loop
when
  $activeLevel : ActiveLevel( )
  DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ROOT", "ZP2015_LEVEL_SECTION", "ZP2015_LEVEL_SERIES", "ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
  $itemType : RulItemTypeExt(code == "ZP2015_ARRANGEMENT_TYPE")
  $itemSpec : RulItemSpecExt() from $itemType.rulItemSpecList
then
  $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end


rule "HP_009 Způsob pořádání doporučený pokud není nastaven výše"
no-loop
when
  $activeLevel : ActiveLevel( )  
  DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ROOT", "ZP2015_LEVEL_SECTION", "ZP2015_LEVEL_SERIES", "ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
  not ( DescItem(type=="ZP2015_ARRANGEMENT_TYPE") from $activeLevel.descItems )
  $itemType : RulItemTypeExt(code == "ZP2015_ARRANGEMENT_TYPE")
then
  $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end


rule "HP_010 Složka nebo jednotlivost může být pod složkou"
no-loop
when    
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $parentDescItems   
    // rodic neni slozka jednotlivosti (s typem EJ)    
    not( DescItem(type=="ZP2015_FOLDER_TYPE" && specCode=="ZP2015_FOLDER_SINGLE_TYPE" ) from $parentDescItems )
    // rodice neni složka s dodatečnými EJ (obyvkle složka manip.seznamu)
    not( DescItem(type=="ZP2015_EXTRA_UNITS" ) from $parentDescItems )
    
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM") ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "HP_011 Pokud je rodič složka s typem EJ (jednotlivostí), tak může být jen jednotlivost"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems )
    DescItem(type=="ZP2015_FOLDER_TYPE" && specCode=="ZP2015_FOLDER_SINGLE_TYPE" ) from $parentDescItems
    $itemSpec : RulItemSpecExt(code in ("ZP2015_LEVEL_ITEM") ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

// HP_012 Jedna složka v hierarchii může určit EJ
rule "HP_012_01 Jedna složka v hierarchii může určit EJ - množstevní EJ a digitální"
no-loop
when
    $activeLevel : ActiveLevel( )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.descItems
    // neexistje nadrizeny level typu slozka
    not ( $level : Level( this!=$activeLevel ) and
         DescItem(type=="ZP2015_FOLDER_TYPE" && specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_SINGLE_TYPE", 
         		"ZP2015_FOLDER_DAO") ) from $level.descItems )
    // nemá výše uvedenu ukládací jednotku - nehromadinového typu    
    not ($storageItem : DescItem(type=="ZP2015_STORAGE_ID" && structured!=null ) from $activeLevel.descItems and
         StructObjItem(type=="ZP2015_PACKET_TYPE" && specCode not in ("ZP2015_PACKET_TYPE_KAR", "ZP2015_PACKET_TYPE_FAS")) from $storageItem.structured.items )
    
    $itemType : RulItemTypeExt(code == "ZP2015_FOLDER_TYPE")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_FOLDER_UNITS") ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "HP_012_02 Jedna složka v hierarchii může určit EJ - digitální"
no-loop
when
    $activeLevel : ActiveLevel( )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.descItems
    // neexistje nadrizeny level typu slozka
    not ( $level : Level( this!=$activeLevel ) and
         DescItem(type=="ZP2015_FOLDER_TYPE" && specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_SINGLE_TYPE", 
         		"ZP2015_FOLDER_DAO") ) from $level.descItems )
    $itemType : RulItemTypeExt(code == "ZP2015_FOLDER_TYPE")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_FOLDER_DAO") ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "HP_012_03 Jedna složka v hierarchii může určit EJ - s typem EJ"
no-loop
when
    $activeLevel : ActiveLevel( )
    // tyka se manip. seznamu, inventare a starsich pomucek
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_OTHER", "ZP2015_ARRANGEMENT_MAN", "ZP2015_ARRANGEMENT_INV") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.descItems
    // neexistje nadrizeny level typu slozka
    not ( $level : Level( this!=$activeLevel ) and
         DescItem(type=="ZP2015_FOLDER_TYPE" && specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_SINGLE_TYPE", 
         		"ZP2015_FOLDER_DAO") ) from $level.descItems )
    $itemType : RulItemTypeExt(code == "ZP2015_FOLDER_TYPE")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_FOLDER_SINGLE_TYPE") ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "HP_013 Pokud je nadřazená složka s uvedenim EJ, hromadina či digitální, potom musí být logická"
no-loop
when
    $activeLevel : ActiveLevel( parent!=null  )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.descItems
    $level : Level( this!=$activeLevel )
    DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_SINGLE_TYPE", "ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_DAO" ) ) ) from $level.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_FOLDER_TYPE")
    $itemSpec : RulItemSpecExt(code == "ZP2015_FOLDER_LOGICAL" ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end


rule "HP_014 Část jednotlivosti může být pod jednotlivostí nebo částí jednotlivosti"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_LEVEL_TYPE")
    $activeLevel  : ActiveLevel( parent!=null && $parentDescItems: parent.descItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $parentDescItems
    $itemSpec : RulItemSpecExt(code == "ZP2015_LEVEL_PART" ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end


//------------------------------------------------------------------
// Ukládací jednotka
//-----------------------------------------------------------------


rule "UJ_001 Ukládací jednotka na množstevní složce a složce s EJ - povinně"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.ownDescItems
    DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_SINGLE_TYPE") ) ) from $activeLevel.ownDescItems
    // uložení není určeno výše
    not ( $level : Level( this!=$activeLevel ) and
          DescItem(type=="ZP2015_STORAGE_ID") from $level.descItems )
    // pevné spojení
    not DescItem(type=="ZP2015_ITEM_LINK") from $activeLevel.descItems
    // pokud je ulozeno v DA, potom je ukl.jednotka volitelna
    not DescItem(type=="ZP2015_AIP_ID") from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_STORAGE_ID")
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
    $itemType.setPolicyTypeCode("ZP2015_POL_STORAGE_ID");
end

rule "UJ_002 Ukládací jednotka možná na logické složce"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.ownDescItems
    DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_LOGICAL") ) ) from $activeLevel.ownDescItems
    // zneplatněný záznam
    not DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    // není pevné spojení
    not DescItem(type=="ZP2015_ITEM_LINK") from $activeLevel.descItems
    // nemá uložení výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_STORAGE_ID" ) from $level.ownDescItems
    )
    $itemType : RulItemTypeExt(code == "ZP2015_STORAGE_ID")
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "UJ_003 Ukládací jednotka v případě dodatečných EJ"
// využívá se pro složku manip seznamu a to i ve starších pomůckách
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $activeLevel.ownDescItems
    DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_LOGICAL") ) ) from $activeLevel.ownDescItems
    // nemá uložení výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_STORAGE_ID" ) from $level.ownDescItems
    )
    // složka s dodatečnými EJ (obyvkle složka manip.seznamu)
    DescItem(type=="ZP2015_EXTRA_UNITS" ) from $activeLevel.ownDescItems
    $itemType : RulItemTypeExt(code == "ZP2015_STORAGE_ID")
then
    // System.out.println("UJ_003: nodeId="+$activeLevel.getNodeId());
    $itemType.setMinType(RulItemType.Type.REQUIRED);
    $itemType.setPolicyTypeCode("ZP2015_POL_STORAGE_ID");
    $itemType.setRepeatable(true);
end


rule "UJ_004 Uložení v DA na digitální složce"
no-loop
when
    $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_DAO") ) ) from $activeLevel.ownDescItems
    not DescItem(type=="ZP2015_ITEM_LINK") from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_AIP_ID")
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
    $itemType.setPolicyTypeCode("ZP2015_POL_STORAGE_ID");
end


rule "UJ_005 Uložení v DA možné na složce s jedním typem arch"
no-loop
when
    $activeLevel: ActiveLevel( )
    // ma nastaven typ slozky - slozka jednotlivosti
    DescItem(type=="ZP2015_FOLDER_TYPE" && specCode=="ZP2015_FOLDER_SINGLE_TYPE" ) from $activeLevel.ownDescItems
    not DescItem(type=="ZP2015_ITEM_LINK") from $activeLevel.descItems
    $itemType : RulItemTypeExt(code in ("ZP2015_AIP_ID") )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end


rule "UJ_006 Ukládací jednotka na jednotlivosti pokud není výše - povinně - pokud nemá potomky (vyjma KZA a ZZA, KTT)"
no-loop
when
    $activeLevel: ActiveLevel( !hasChildren )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_ITEM" ) from $activeLevel.ownDescItems
    // nejedná se o Film nebo zvuk záznam
    not DescItem(type=="ZP2015_UNIT_TYPE" && (specCode in ("ZP2015_UNIT_TYPE_KZA", "ZP2015_UNIT_TYPE_ZZA", "ZP2015_UNIT_TYPE_KTT") ) ) from $activeLevel.descItems
    // není s ničím pevně spojena
    not DescItem(type in ("ZP2015_ITEM_LINK") ) from $activeLevel.descItems
    // není uloženo v DA
    not DescItem(type in ("ZP2015_AIP_ID") ) from $activeLevel.descItems
    // nemá uložení výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_STORAGE_ID" ) from $level.ownDescItems
    )
    $itemType : RulItemTypeExt(code in ("ZP2015_STORAGE_ID") )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
    $itemType.setPolicyTypeCode("ZP2015_POL_STORAGE_ID");
end


rule "UJ_007 Uložení v digitálním archivu možné na jednotlivosti"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_ITEM" ) from $activeLevel.ownDescItems
    // nemá poděděný typ složky množstevní nebo s EJ
    not DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_SINGLE_TYPE", "ZP2015_FOLDER_DAO") ) ) from $activeLevel.descItems
    // není s ničím pevně spojena
    not DescItem(type in ("ZP2015_ITEM_LINK") ) from $activeLevel.descItems
    // není uloženo v DA výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_AIP_ID" ) from $level.ownDescItems
    )
    // není zneplatněný záznam
    not DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    $itemType : RulItemTypeExt(code in ("ZP2015_AIP_ID") )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
    $itemType.setPolicyTypeCode("ZP2015_POL_STORAGE_ID");
end

rule "UJ_008 Ukládací jednotka na jednotlivosti - doporučené pro KZA, ZZA"
// Pravidlo se vyhodnocuje později - po nastavení volitelnosti
no-loop
when
    // pokud ma dilci casti, tak muze byt ukladaci jednotka specifikovana na nich
    $activeLevel: ActiveLevel(  )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_ITEM" ) from $activeLevel.ownDescItems
    // nemá poděděný typ složky množstevní nebo s EJ
    not DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_SINGLE_TYPE") ) ) from $activeLevel.descItems
    // nemá uložení výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_STORAGE_ID" ) from $level.ownDescItems
    )
    // neni pevne spojeni
    not DescItem(type=="ZP2015_ITEM_LINK") from $activeLevel.descItems
    // neni ciste digitalni
    not DescItem(type=="ZP2015_AIP_ID") from $activeLevel.descItems
    // není zneplatněný záznam
    not DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    // jedná se o Film nebo zvuk záznam
    DescItem(type=="ZP2015_UNIT_TYPE" && (specCode in ("ZP2015_UNIT_TYPE_KZA", "ZP2015_UNIT_TYPE_ZZA") ) ) from $activeLevel.ownDescItems    
    $itemType : RulItemTypeExt(code == "ZP2015_STORAGE_ID")
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

rule "UJ_009 Ukládací jednotka na jednotlivosti bez uložení - doporučené pro KTT"
no-loop
when
    $activeLevel: ActiveLevel( !hasChildren )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_ITEM" ) from $activeLevel.ownDescItems
    // nemá uložení definováno výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_STORAGE_ID" ) from $level.ownDescItems
    )
    // neni pevne spojeni
    not DescItem(type=="ZP2015_ITEM_LINK") from $activeLevel.descItems
    // neni ciste digitalni
    not DescItem(type=="ZP2015_AIP_ID") from $activeLevel.descItems
    // není zneplatněný záznam
    not DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    // jedná se o kartotéku
    DescItem(type=="ZP2015_UNIT_TYPE" && (specCode in ("ZP2015_UNIT_TYPE_KTT") ) ) from $activeLevel.ownDescItems    
    $itemType : RulItemTypeExt(code == "ZP2015_STORAGE_ID")
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

// Ukládací jednotka pro kartoteční zásuvku
rule "UJ_010 Ukládací jednotka pro kartoteční zásuvku"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_PART" ) from $activeLevel.ownDescItems
    // nemá uložení výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_STORAGE_ID" ) from $level.ownDescItems
    )
    // jedná se o kartotéční zásuvku
    DescItem(type=="ZP2015_UNIT_TYPE" && (specCode in ("ZP2015_UNIT_TYPE_KTT_BOX") ) ) from $activeLevel.ownDescItems    
    $itemType : RulItemTypeExt(code == "ZP2015_STORAGE_ID")
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

// UJ_011 Na množstevní složce nebo výše musí být uvedena jedna hromadinová ukl. jednotka
// - druhá polovina kontroly je v rámci HP012
rule "UJ_011 Na množstevní složce (pokud je přímo na ní) musí být uvedena jedna hromadinová ukl. jednotka"
salience -200
no-loop
when
    $activeLevel: ActiveLevel( )
    // typ složky množstevní
    DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_UNITS") ) ) from $activeLevel.ownDescItems
    
    $descItem : DescItem(type=="ZP2015_STORAGE_ID" && structured!=null ) from $activeLevel.ownDescItems
    not (StructObjItem(type=="ZP2015_PACKET_TYPE" && specCode in ("ZP2015_PACKET_TYPE_KAR", "ZP2015_PACKET_TYPE_FAS")) from $descItem.structured.items )

    // není zneplatněný záznam
    not DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    // neni ciste digitalni
    not DescItem(type=="ZP2015_AIP_ID") from $activeLevel.descItems
    
    $itemType : RulItemTypeExt(code == "ZP2015_STORAGE_ID")
then
    // System.out.println("UJ_011_01");
    $itemType.setType(RulItemType.Type.IMPOSSIBLE);
end


rule "UJ_013 Ukládací jednotka na jednotlivosti pokud není výše - doporučeně - pokud má potomky (vyjma KZA a ZZA, KTT)"
no-loop
when
    $activeLevel: ActiveLevel( hasChildren )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_ITEM" ) from $activeLevel.ownDescItems
    // nejedná se o Film nebo zvuk záznam
    not DescItem(type=="ZP2015_UNIT_TYPE" && (specCode in ("ZP2015_UNIT_TYPE_KZA", "ZP2015_UNIT_TYPE_ZZA", "ZP2015_UNIT_TYPE_KTT") ) ) from $activeLevel.descItems
    // není s ničím pevně spojena
    not DescItem(type in ("ZP2015_ITEM_LINK") ) from $activeLevel.descItems
    // není uloženo v DA
    not DescItem(type in ("ZP2015_AIP_ID") ) from $activeLevel.descItems
    // nemá uložení výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_STORAGE_ID" ) from $level.ownDescItems
    )
    // není zneplatněný záznam
    not DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    $itemType : RulItemTypeExt(code in ("ZP2015_STORAGE_ID") )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
    $itemType.setPolicyTypeCode("ZP2015_POL_STORAGE_ID");
end


rule "UJ_014 Ukládací jednotka na části jednotlivosti pokud není výše - povinně"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_PART" ) from $activeLevel.ownDescItems
    // není s ničím pevně spojena
    not DescItem(type in ("ZP2015_ITEM_LINK") ) from $activeLevel.descItems
    // není uloženo v DA
    not DescItem(type in ("ZP2015_AIP_ID") ) from $activeLevel.descItems
    // nemá uložení výše
    not (
       $level: Level(this!=$activeLevel) and
       DescItem(type=="ZP2015_STORAGE_ID" ) from $level.ownDescItems
    )
    $itemType : RulItemTypeExt(code in ("ZP2015_STORAGE_ID") )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
    $itemType.setPolicyTypeCode("ZP2015_POL_STORAGE_ID");
end


rule "UJ_015 Ukládací jednotka na části jednotlivosti pokud není výše - možné vždy"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_PART" ) from $activeLevel.ownDescItems
    // není s ničím pevně spojena
    not DescItem(type in ("ZP2015_ITEM_LINK") ) from $activeLevel.descItems
    // není uloženo v DA
    not DescItem(type in ("ZP2015_AIP_ID") ) from $activeLevel.descItems
    // není zneplatněný záznam
    not DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    $itemType : RulItemTypeExt(code in ("ZP2015_STORAGE_ID") )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
    $itemType.setPolicyTypeCode("ZP2015_POL_STORAGE_ID");
end


//
// Univerzální prvku popisu
//

rule "PP_001 Univerzální prvky popisu - vždy možné"
no-loop
when
    $itemType : RulItemTypeExt(code in
    ( "ZP2015_OTHER_ID",
      // 4.3.1 Odkaz na původce 
      "ZP2015_ORIGINATOR", 
      // 4.3.2 Dějiny jednotky popisu
      "ZP2015_UNIT_HIST", 
      // 4.3.3 Způsob uspořádání jednotky popisu
      "ZP2015_UNIT_ARR",
      // 4.3.4 Tematický popis jednotky popisu
      "ZP2015_UNIT_CONTENT",
      // 4.3.5 Přímý zdroj akvizice
      "ZP2015_UNIT_SOURCE", 
      // ZP4.3.6 Budoucí přírůstky 
      "ZP2015_FUTURE_UNITS",
      // 4.4.1 Podmínky přístupu, práva k jednotce popisu a její reprodukci
      "ZP2015_UNIT_ACCESS",
      // 4.4.2 Možnost zveřejnění informací o jednotce popisu
      "ZP2015_UNIT_INFO_RIGHTS", 
      "ZP2015_RESTRICTION_ACCESS_SHARED", 
      "ZP2015_RESTRICTION_ACCESS_INLINE", 
      "ZP2015_PUBLISHED",
      // 4.4.3 Možnost zveřejnění reprodukce jednotky popisu
      "ZP2015_UNIT_COPY_RIGHTS",
      // 4.4.4 Fyzický stav jednotky popisu a technické požadavky
      "ZP2015_UNIT_CURRENT_STATUS",
      "ZP2015_UNIT_DAMAGE_TYPE",
      // ZP 4.5.1 Identifikace předlohy kopie
      "ZP2015_COPY_SOURCE",
      // ZP 4.5.2
      "ZP2015_RELATED_UNITS",
      "ZP2015_RELATED_UNITS_LINK",
      // ZP 4.5.3
      "ZP2015_EXISTING_COPY",
      // Poznámky - ZP 4.6.1, 4.6.2
      "ZP2015_INTERNAL_NOTE", "ZP2015_NOTE",
      // 4.7.1 Zpracovatel jednotky popisu
      "ZP2015_ARRANGER",
      // 4.7.1 Informace o zpracování
      "ZP2015_ARRANGEMENT_INFO",
      // 4.7.2 Pravidla zpracování jednotky popisu
      "ZP2015_ARRANGE_RULES",
      // ZP4.7.3 Datum (data) popisu 
      "ZP2015_DESCRIPTION_DATE",
      // ZP 5.2.10 Jazyk
      "ZP2015_LANGUAGE",
      // ZP 5.2.10 písmo
      "ZP2015_WRITING",
      // ZP 5.2.11 Edice a literatura
      "ZP2015_EDITION",
      // Obecná příloha 
      "ZP2015_ATTACHMENT",
      // Role entit jsou možné vždy
      "ZP2015_ENTITY_ROLE",
      "ZP2015_TITLE_PUBLIC",
      "ZP2015_ALTERNATIVE_DESCRIPTION_INLINE"
      ) )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "PP_002 Univerzální prvky popisu - možné od série níže"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in (
        "ZP2015_LEVEL_SERIES", "ZP2015_LEVEL_FOLDER", 
        "ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART",
        "ZP2015_AP_REF") 
        ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code in
    ( 
      // ZP4.2.4 Formální název jednotky popisu
      "ZP2015_FORMAL_TITLE"
     ) )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "PP_003 Univerzální prvky popisu - možné od složky níže"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", 
                             "ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code in
    ( 
      // ZP5.2.3 Způsob a forma dochování
      "ZP2015_STORAGE_COND",
      // ZP5.2.4 Rozměry, hmotnost, velikost, množství 
      "ZP2015_SIZE",
      // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
      "ZP2015_ITEM_MAT",
      // ZP5.2.9 Díl, část, pořadí vydání jednotky popisu
      "ZP2015_PART",
      // číslo digitalizátu
      "ZP2015_DAO_ID",
      // odkaz na digitalizát
      "ZP2015_DAO_LINK"
     ) )    
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end


rule "PP_004 Univerzální prvky popisu - možné na složce"
no-loop
when
    $activeLevel: ActiveLevel( )
    $itemType : RulItemTypeExt(code in
    (
      // ZP5.2.2 Název autorského díla
      "ZP2015_ITEM_TITLE_REF"
     ) )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end


// PP_005 Zneplatněný záznam možný pro složky, jednotlivosti a části jednotlivostí
rule "PP_005_01 Zneplatněný záznam možný pro složky, jednotlivosti a části jednotlivostí - prvek popisu"
no-loop
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in (
        // Zneplatněný záznam
        "ZP2015_INVALID_RECORD"
        ) )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "PP_005_02 Zneplatněný záznam možný pro složky, jednotlivosti a části jednotlivostí - specifikace"
no-loop
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in (
        // Zneplatněný záznam
        "ZP2015_INVALID_RECORD"
        ) )
    $itemSpec: RulItemSpecExt( ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "PP_006 Zneplatněný záznam - doporučené prvky popisu"
no-loop
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in (
        // Veřejná poznámka
        "ZP2015_NOTE"
        ) )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end




//
// RE_001 Související entita u jednotky popisu
//
rule "RE_001 Související entita u jednotky popisu - typ"
no-loop
when $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "RE_001 Související entita u jednotky popisu - specifikace"
no-loop
when $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // osoba/bytost související s jednotkami popisu
        "ZP2015_ENTITY_ROLE_66",
        // rod/rodina související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_67",
		// korporace související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_68",
		// událost související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_69",
		// dílo/výtvor související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_70",
		// geografický objekt související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_71",
		// obecný pojem související s jednotkou popisu
		"ZP2015_ENTITY_ROLE_72",
		// sekundární klasifikace
		"ZP2015_ENTITY_ROLE_83"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

//
// RE_002 Související entita v katalogu je doporučená pro určené typy archiválií
//
rule "RE_002 Související entita v katalogu je doporučená pro určené typy archiválií - typ"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
     DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT") ) from $activeLevel.descItems
     DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP",
     	"ZP2015_UNIT_TYPE_UKN", "ZP2015_UNIT_TYPE_RKP", "ZP2015_UNIT_TYPE_HDB",
     	"ZP2015_UNIT_TYPE_PPR", "ZP2015_UNIT_TYPE_IND", "ZP2015_UNIT_TYP_ELE",
     	"ZP2015_UNIT_TYPE_REP", 
     	"ZP2015_UNIT_TYPE_KTT",
     	"ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ", "ZP2015_UNIT_TYPE_OTD", "ZP2015_UNIT_TYPE_OTC",
     	"ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL",
     	"ZP2015_UNIT_TYPE_TVY", 
     	"ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE",
     	"ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD", "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI",
     	"ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
     	// "ZP2015_UNIT_TYPE_FAL", 
     	"ZP2015_UNIT_TYPE_DFO",
     	"ZP2015_UNIT_TYPE_KZA", "ZP2015_UNIT_TYPE_ZZA",
     	"ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP",
     	"ZP2015_UNIT_TYPE_POH", "ZP2015_UNIT_TYPE_PKT",
     	"ZP2015_UNIT_TYPE_CPA", "ZP2015_UNIT_TYPE_STO",
     	"ZP2015_UNIT_TYPE_PNP", "ZP2015_UNIT_TYPE_PFP",
     	"ZP2015_UNIT_TYPE_JIN", "ZP2015_UNIT_TYPE_OTHER",
     	// "ZP2015_UNIT_TYPE_KTT_BOX", "ZP2015_UNIT_TYPE_KTT_ITEM"
     	"ZP2015_UNIT_TYPE_PART") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

rule "RE_002 Související entita v katalogu je doporučená pro určené typy archiválií - specifikace"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
     DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT") ) from $activeLevel.descItems
     DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP",
     	"ZP2015_UNIT_TYPE_UKN", "ZP2015_UNIT_TYPE_RKP", "ZP2015_UNIT_TYPE_HDB",
     	"ZP2015_UNIT_TYPE_PPR", "ZP2015_UNIT_TYPE_IND", "ZP2015_UNIT_TYP_ELE",
     	"ZP2015_UNIT_TYPE_REP", 
     	"ZP2015_UNIT_TYPE_KTT",
     	"ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ", "ZP2015_UNIT_TYPE_OTD", "ZP2015_UNIT_TYPE_OTC",
     	"ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL",
     	"ZP2015_UNIT_TYPE_TVY", 
     	"ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE",
     	"ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD", "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI",
     	"ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
     	// "ZP2015_UNIT_TYPE_FAL", 
     	"ZP2015_UNIT_TYPE_DFO",
     	"ZP2015_UNIT_TYPE_KZA", "ZP2015_UNIT_TYPE_ZZA",
     	"ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP",
     	"ZP2015_UNIT_TYPE_POH", "ZP2015_UNIT_TYPE_PKT",
     	"ZP2015_UNIT_TYPE_CPA", "ZP2015_UNIT_TYPE_STO",
     	"ZP2015_UNIT_TYPE_PNP", "ZP2015_UNIT_TYPE_PFP",
     	"ZP2015_UNIT_TYPE_JIN", "ZP2015_UNIT_TYPE_OTHER",
     	// "ZP2015_UNIT_TYPE_KTT_BOX", "ZP2015_UNIT_TYPE_KTT_ITEM"
     	"ZP2015_UNIT_TYPE_PART") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // osoba/bytost související s jednotkami popisu
        "ZP2015_ENTITY_ROLE_66",
        // rod/rodina související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_67",
		// korporace související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_68",
		// událost související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_69",
		// dílo/výtvor související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_70",
		// geografický objekt související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_71",
		// obecný pojem související s jednotkou popisu
		"ZP2015_ENTITY_ROLE_72"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//
// RE_003 Volitelné role pro jednotka popisu bez Typu archiválie
//
// rule "RE_003 Volitelné role pro jednotka popisu bez Typu archiválie - specifikace"
// no-loop
// when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
//     not (DescItem(type=="ZP2015_UNIT_TYPE") from $ownItems )
//     $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
//     $itemSpec: RulItemSpecExt( ) from $itemType.rulItemSpecList
// then
//    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
// end
//

//
// RE_005 Jednotka popisu s PP Zneplatněný záznam
//
rule "RE_005 Jednotka popisu s PP Zneplatněný záznam"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	 DescItem(type=="ZP2015_INVALID_RECORD") from $ownItems
     $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
     $itemSpec: RulItemSpecExt( code not in ( "ZP2015_ENTITY_ROLE_5", "ZP2015_ENTITY_ROLE_64", "ZP2015_ENTITY_ROLE_65" ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end



//------------------------------------------------------------------
// Prvky popisu pro každou složku
//-----------------------------------------------------------------

rule "Možné role entit pro složku (i sérii)"
no-loop
when $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_SERIES") ) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",        
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // vydavatelé / nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // pečetitelé
        "ZP2015_ENTITY_ROLE_17",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // žadatelé
        "ZP2015_ENTITY_ROLE_22",
        // odesilatelé
        "ZP2015_ENTITY_ROLE_24",
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // redaktor
        "ZP2015_ENTITY_ROLE_32",
        // kartografové
        "ZP2015_ENTITY_ROLE_33",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // překladatelé
        "ZP2015_ENTITY_ROLE_44",
        // svědci
        "ZP2015_ENTITY_ROLE_46",
        // ručitelé (rukojmě)
        "ZP2015_ENTITY_ROLE_47",
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vydání
        "ZP2015_ENTITY_ROLE_58",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end


//----------------------------------------------------------------
// Složka manipulačního seznamu
//----------------------------------------------------------------

rule "Složka manipulačního seznamu"
no-loop
when
    // nesmi jiz mit deti
    $activeLevel : ActiveLevel( !hasChildren )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_MAN", "ZP2015_ARRANGEMENT_OTHER") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_FOLDER_TYPE" && specCode in ("ZP2015_FOLDER_UNITS", 
    													"ZP2015_FOLDER_LOGICAL", 
    													"ZP2015_FOLDER_SINGLE_TYPE",
    													"ZP2015_FOLDER_DAO") ) from $activeLevel.descItems    
    // neexistuje rodič, který je složkou množstevní, s typem EJ nebo digitální
    not ( $level : Level( this!=$activeLevel ) and
         DescItem(type=="ZP2015_FOLDER_TYPE" && specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_SINGLE_TYPE", 
         		"ZP2015_FOLDER_DAO") ) from $level.descItems )
    $itemType : RulItemTypeExt(code == "ZP2015_EXTRA_UNITS")
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Složka manipulačního seznamu - všechny typy archiválií"
no-loop
when
    $activeLevel : ActiveLevel( !hasChildren )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_MAN", "ZP2015_ARRANGEMENT_OTHER") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_FOLDER_TYPE" && specCode in ("ZP2015_FOLDER_UNITS", 
    												    "ZP2015_FOLDER_LOGICAL",
    												    "ZP2015_FOLDER_SINGLE_TYPE",
    												    "ZP2015_FOLDER_DAO") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_EXTRA_UNITS")
    $itemSpec : RulItemSpecExt() from $itemType.rulItemSpecList
then
  $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end


// Pořadové číslo povinné pokud je určen způsob pořádání
// zde je označeno, jen jako možné - je generováno akcí
rule "Pořadové číslo - možné"
no-loop
when
    $activeLevel : ActiveLevel( )
    $itemType : RulItemTypeExt(code == "ZP2015_SERIAL_NUMBER")
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
    $itemType.setPolicyTypeCode("SERIAL_NO");
end

// referenční označení možné pro ostatní typy pro nejvyšší uzly
// neni mozne pro koren
rule "Referenční označení - možné pro série vždy"
no-loop
when
    $activeLevel: ActiveLevel( parent!=null && $items: descItems)
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ROOT" , "ZP2015_LEVEL_SECTION", "ZP2015_LEVEL_SERIES") ) from $items
    not DescItem(type=="ZP2015_SERIAL_NUMBER") from $items
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_ID")
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
    $itemType.setPolicyTypeCode("REF_NO");
end

// referenční označení v MAN|INV|KAT - možné pro uzly mimo kořen
// neni mozne pro koren
rule "Referenční označení - možné"
no-loop
when
    $activeLevel: ActiveLevel( parent!=null )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_MAN", "ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT") ) from $activeLevel.descItems
    not DescItem(type=="ZP2015_EXTRA_UNITS") from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_ID")
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
    $itemType.setPolicyTypeCode("REF_NO");
end

//----------------------------------------------------
// Druhy archivalii
//---------------------------------------------------

// TA_001 U složky s typem EJ se uvádí její druh EJ a počet
rule "TA_001 U složky s typem EJ se uvádí její druh EJ a počet - povinně"
no-loop
when
    $activeLevel: ActiveLevel( )
    // ma nastaven typ slozky - slozka jednotlivosti
    DescItem(type=="ZP2015_FOLDER_TYPE" && specCode=="ZP2015_FOLDER_SINGLE_TYPE" ) from $activeLevel.ownDescItems
    $itemType : RulItemTypeExt(code in ("ZP2015_UNIT_TYPE", "ZP2015_UNIT_COUNT") )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end


rule "TA_002 Pod množstevní složkou lze uvést u podřízené složky druh archiválií a počet"
no-loop
when 
    $activeLevel: ActiveLevel( )
    // jedna se o logickou slozku
    DescItem(type=="ZP2015_FOLDER_TYPE" && specCode=="ZP2015_FOLDER_LOGICAL" ) from $activeLevel.ownDescItems
    // je pod hromadnou slozkou
    $level : Level( this!=$activeLevel )
    DescItem(type=="ZP2015_FOLDER_TYPE" && (specCode in ("ZP2015_FOLDER_UNITS" ) ) ) from $level.descItems
    $itemType : RulItemTypeExt(code in ("ZP2015_UNIT_TYPE") )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "TA_003 Pokud je na logické složce uveden typ archiválie, je POVINNÉ uvést počet"
no-loop
when 
    $activeLevel: ActiveLevel( )
    // jedna se o logickou slozku
    DescItem(type=="ZP2015_FOLDER_TYPE" && specCode=="ZP2015_FOLDER_LOGICAL" ) from $activeLevel.ownDescItems
    // ma uveden typ archivalie
    DescItem(type=="ZP2015_UNIT_TYPE" ) from $activeLevel.ownDescItems
    $itemType : RulItemTypeExt(code in ("ZP2015_UNIT_COUNT") )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end


// U složky man. seznamu lze vybrat skoro libovolny typ jendotlivosti
// Nelze vybrat cast jednotlivosti
rule "TA_004 Možné druhy archiválie na složce ve starší pomůcce a manipulačním seznamu"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_MAN", "ZP2015_ARRANGEMENT_OTHER") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_TYPE")
    $itemSpec : RulItemSpecExt(code in ( "ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP",
        "ZP2015_UNIT_TYPE_UKN", 
        // Rukopisy 
        "ZP2015_UNIT_TYPE_RKP",
        // Podací protokoly
        "ZP2015_UNIT_TYPE_PPR",
        // Indexy
        "ZP2015_UNIT_TYPE_IND", 
        // Elenchy
        "ZP2015_UNIT_TYP_ELE",
        // Repertáře
        "ZP2015_UNIT_TYPE_REP",
        // Kartotéky
        "ZP2015_UNIT_TYPE_KTT",
        // Pečetidla
        "ZP2015_UNIT_TYPE_PEC",
        // Razítka
        "ZP2015_UNIT_TYPE_RAZ",
        // Samostatné pečetě, odlitky pečetí a otisky typářů
        "ZP2015_UNIT_TYPE_OTD",
        // Kopie otisků 
        "ZP2015_UNIT_TYPE_OTC",
        // Mapy
        "ZP2015_UNIT_TYPE_MAP",
        // Atlasy
        "ZP2015_UNIT_TYPE_ATL",
        // Technické výkresy
        "ZP2015_UNIT_TYPE_TVY",
        // Grafické listy
        "ZP2015_UNIT_TYPE_GLI",
        // Kresby
        "ZP2015_UNIT_TYPE_KRE",
        // Fotografie na papírové podložce
        "ZP2015_UNIT_TYPE_FSN",
        // Fotografické desky
        "ZP2015_UNIT_TYPE_FSD",
        // Listové filmy
        "ZP2015_UNIT_TYPE_LFI",
        // Svitkové filmy
        "ZP2015_UNIT_TYPE_SFI",
        // Kinofilmy
        "ZP2015_UNIT_TYPE_KIN",
        // Mikrofilmy
        "ZP2015_UNIT_TYPE_MF",
        // Mikrofiše
        "ZP2015_UNIT_TYPE_MFS",
        // Fotoalba
        "ZP2015_UNIT_TYPE_FAL",
        // Digitální fotografie
        "ZP2015_UNIT_TYPE_DFO",
        // Kinematografické záznamy (díla) v analogové i digitální podobě
        "ZP2015_UNIT_TYPE_KZA",
        // Zvukové záznamy (díla) v analogové i digitální podobě
        "ZP2015_UNIT_TYPE_ZZA",
        // Tisky do roku 1800
        "ZP2015_UNIT_TYPE_TIO",
        // Tisky po roce 1800
        "ZP2015_UNIT_TYPE_TIP",
        // Pohlednice
        "ZP2015_UNIT_TYPE_POH",
        // Plakáty
        "ZP2015_UNIT_TYPE_PKT",
        // Cenné papíry
        "ZP2015_UNIT_TYPE_CPA",
        // Štočky
        "ZP2015_UNIT_TYPE_STO",
        // Předměty numizmatické povahy
        "ZP2015_UNIT_TYPE_PNP",
        // Předměty faleristické povahy
        "ZP2015_UNIT_TYPE_PFP",
        // Jiné
        "ZP2015_UNIT_TYPE_JIN"
         ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

// 3.4.2 Inventar
// U logické složky inventare nesmi byt uvedene typy
rule "TA_005 Možné druhy archiválie na složce v inventáři"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode == "ZP2015_ARRANGEMENT_INV" ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_TYPE")
    $itemSpec : RulItemSpecExt(
    code in (
    // Rukopis
    "ZP2015_UNIT_TYPE_RKP",
    // Razítko
    "ZP2015_UNIT_TYPE_RAZ",
    // Samostatná pečeť, odlitek pečeti, otisk typáře
    "ZP2015_UNIT_TYPE_OTD",
    // Kopie otisku
    "ZP2015_UNIT_TYPE_OTC",
    // Mapa
    "ZP2015_UNIT_TYPE_MAP",
    // Technický výkres
    "ZP2015_UNIT_TYPE_TVY",
    // Grafický list
    "ZP2015_UNIT_TYPE_GLI",
    // Kresba
    "ZP2015_UNIT_TYPE_KRE",
    // Fotografie na papírové podložce
    "ZP2015_UNIT_TYPE_FSN",
    // Fotografická deska
    "ZP2015_UNIT_TYPE_FSD",
    // Listový filmy
    "ZP2015_UNIT_TYPE_LFI",
    // Svitkový film
    "ZP2015_UNIT_TYPE_SFI",
    // Kinofilm
    "ZP2015_UNIT_TYPE_KIN",
    // Mikrofilm
    "ZP2015_UNIT_TYPE_MF",
    // Mikrofiš
    "ZP2015_UNIT_TYPE_MFS",
    // Digitální fotografie
    "ZP2015_UNIT_TYPE_DFO",
    // Kinematografický záznam (dílo) v analogové i digitální podobě
    "ZP2015_UNIT_TYPE_KZA",
    // Zvukový záznam (dílo) v analogové i digitální podobě
    "ZP2015_UNIT_TYPE_ZZA",
    // Tisk po roce 1800
    "ZP2015_UNIT_TYPE_TIP",
    // Pohlednice
    "ZP2015_UNIT_TYPE_POH",
    // Plakát
    "ZP2015_UNIT_TYPE_PKT",
    // Cenný papír
    "ZP2015_UNIT_TYPE_CPA",
    // Štoček
    "ZP2015_UNIT_TYPE_STO",
    // Předmět numizmatické povahy
    "ZP2015_UNIT_TYPE_PNP",
    // Předmět faleristické povahy
    "ZP2015_UNIT_TYPE_PFP",
    // Jiná
    "ZP2015_UNIT_TYPE_JIN"    
    )) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end


// TA_006 Druh archiválie - povinně u jednotlivosti a části jednotlivosti
rule "TA_006 Druh archiválie - povinně u jednotlivosti a části jednotlivosti"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_TYPE")
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end


rule "Druh archiválie - možné u jednotlivosti a části jednotlivosti (všechny typy pomůcek)"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_TYPE")
    $itemSpec : RulItemSpecExt(code in ( "ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP",
        "ZP2015_UNIT_TYPE_UKN", 
        // Rukopisy 
        "ZP2015_UNIT_TYPE_RKP",
        // Podací protokoly
        "ZP2015_UNIT_TYPE_PPR",
        // Indexy
        "ZP2015_UNIT_TYPE_IND", 
        // Elenchy
        "ZP2015_UNIT_TYP_ELE",
        // Repertáře
        "ZP2015_UNIT_TYPE_REP",
        // Samostatné pečetě, odlitky pečetí a otisky typářů
        "ZP2015_UNIT_TYPE_OTD",
        // Mapy
        "ZP2015_UNIT_TYPE_MAP",
        // Technické výkresy
        "ZP2015_UNIT_TYPE_TVY",
        // Grafické listy
        "ZP2015_UNIT_TYPE_GLI",
        // Kresby
        "ZP2015_UNIT_TYPE_KRE",
        // Fotografie na papírové podložce
        "ZP2015_UNIT_TYPE_FSN",
        // Fotoalba
        "ZP2015_UNIT_TYPE_FAL",
        // Tisky do roku 1800
        "ZP2015_UNIT_TYPE_TIO",
        // Tisky po roce 1800
        "ZP2015_UNIT_TYPE_TIP",
        // Pohlednice
        "ZP2015_UNIT_TYPE_POH",
        // Plakáty
        "ZP2015_UNIT_TYPE_PKT",
        // Cenné papíry
        "ZP2015_UNIT_TYPE_CPA",
        // Jiné
        "ZP2015_UNIT_TYPE_JIN"
         ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Druh archiválie - možné jen u jednotlivosti (všechny typy pomůcek)"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_TYPE")
    $itemSpec : RulItemSpecExt(code in (
        // Kartotéky
        "ZP2015_UNIT_TYPE_KTT",
        // Pečetidla
        "ZP2015_UNIT_TYPE_PEC",
        // Razítka
        "ZP2015_UNIT_TYPE_RAZ",
        // Kopie otisků 
        "ZP2015_UNIT_TYPE_OTC",
        // Atlasy
        "ZP2015_UNIT_TYPE_ATL",
        // Fotografické desky
        "ZP2015_UNIT_TYPE_FSD",
        // Listové filmy
        "ZP2015_UNIT_TYPE_LFI",
        // Svitkové filmy
        "ZP2015_UNIT_TYPE_SFI",
        // Kinofilmy
        "ZP2015_UNIT_TYPE_KIN",
        // Mikrofilmy
        "ZP2015_UNIT_TYPE_MF",
        // Mikrofiše
        "ZP2015_UNIT_TYPE_MFS",
        // Digitální fotografie
        "ZP2015_UNIT_TYPE_DFO",
        // Kinematografické záznamy (díla) v analogové i digitální podobě
        "ZP2015_UNIT_TYPE_KZA",
        // Zvukové záznamy (díla) v analogové i digitální podobě
        "ZP2015_UNIT_TYPE_ZZA",
        // Štočky
        "ZP2015_UNIT_TYPE_STO",
        // Předměty numizmatické povahy
        "ZP2015_UNIT_TYPE_PNP",
        // Předměty faleristické povahy
        "ZP2015_UNIT_TYPE_PFP",
        // Neevidovaná jednotlivost
        "ZP2015_UNIT_TYPE_OTHER"    
         ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Druh archiválie - možné jen u části jednotlivosti (všechny typy pomůcek)"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_TYPE")
    $itemSpec : RulItemSpecExt(code in (
        // Obecná část jednotlivosti
        "ZP2015_UNIT_TYPE_PART"    
         ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

//---------------------------------------------
// Dale jednotlive prvky popisu
//---------------------------------------------

rule "Obsah/regest - doporučený pro složku a níže"
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code in ( "ZP2015_TITLE" ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Obsah/regest - povinný pro sérii"
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_SERIES") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code in ( "ZP2015_TITLE" ) )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end


rule "Ideální popis - jednotlivost"
no-loop
when
    $activeLevel: ActiveLevel( )
    $itemType : RulItemTypeExt(code in ( "ZP2015_ITEM_LINK" ) )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM") ) from $activeLevel.descItems
    not DescItem(type=="ZP2015_STORAGE_ID") from $activeLevel.descItems
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
    $itemType.setRepeatable(true);
end

// Podtypy jednotek popisu
rule "Podtypy jednotek popisu - jednotlivost a část jednotlivosti"
no-loop
when
    $activeLevel: ActiveLevel( )
    $itemType : RulItemTypeExt(code in
    ( 
      "ZP2015_UNIT_SUBTYPE"
     ) )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Podtypy jednotek popisu - množstevní, logické a digitální složky"
no-loop
when
    $activeLevel: ActiveLevel( )
    $itemType : RulItemTypeExt(code in
    ( 
      "ZP2015_UNIT_SUBTYPE"
     ) )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_FOLDER_TYPE" && specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_LOGICAL", "ZP2015_FOLDER_DAO") ) from $activeLevel.descItems
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Podtypy jednotek popisu - pro složky bez typu archiválie"
no-loop
when
    $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER") ) from $activeLevel.ownDescItems
    not (DescItem(type=="ZP2015_UNIT_TYPE" ) from $activeLevel.descItems)
    $itemType : RulItemTypeExt(code=="ZP2015_UNIT_SUBTYPE")
    // technická dokumentace, korespondence
    $itemSpec : RulItemSpecExt(code in ("ZP2015_UNIT_SUBTYPE_TD", "ZP2015_UNIT_SUBTYPE_KOR")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Podtypy jednotek popisu - pro UKN"
no-loop
when
    $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_UKN") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code=="ZP2015_UNIT_SUBTYPE")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_UNIT_SUBTYPE_MTR")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Podtypy jednotek popisu - pro RKP"
no-loop
when
    $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code=="ZP2015_UNIT_SUBTYPE")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_UNIT_SUBTYPE_HDB")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Podtypy jednotek popisu - pro ZP2015_UNIT_TYPE_PFP"
no-loop
when
    $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code=="ZP2015_UNIT_SUBTYPE")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_UNIT_SUBTYPE_STV")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Podtypy jednotek popisu - pro ZP2015_UNIT_TYPE_OTHER a ZP2015_UNIT_TYPE_PART"
no-loop
when
    $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_OTHER",
    												"ZP2015_UNIT_TYPE_PART") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code=="ZP2015_UNIT_SUBTYPE")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_UNIT_SUBTYPE_PA", 
    									"ZP2015_UNIT_SUBTYPE_STVR", "ZP2015_UNIT_SUBTYPE_JMF", "ZP2015_UNIT_SUBTYPE_HDB", "ZP2015_UNIT_SUBTYPE_TD", "ZP2015_UNIT_SUBTYPE_KOR"
    									)) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

// Povolení všech jiných označení
rule "Povolení všech jiných označení (ZP2015_OTHER_ID)"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_OTHER_ID")
    $itemSpec : RulItemSpecExt() from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

// Povolení všech jazyků
rule "Povolení všech jazyků (ZP2015_LANGUAGE, ZP2015_MAJOR_LANG)"
no-loop
when
    $itemType : RulItemTypeExt(code in ("ZP2015_LANGUAGE", "ZP2015_MAJOR_LANG") )
    $itemSpec : RulItemSpecExt() from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

// Na kořeni je povinné uvést jazyk archivního souboru
rule "Jazyk archivního souboru - ZP2015_MAJOR_LANG"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ROOT") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code=="ZP2015_MAJOR_LANG")
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// Datace - strojová a jiná datace
rule "Datace - možná na složce a níže"
no-loop
when
    $activeLevel: ActiveLevel( )
    $itemType : RulItemTypeExt(code in ( "ZP2015_UNIT_DATE", "ZP2015_DATE_OTHER" ) )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
    // neexistje nadrizeny level typu logicka slozka s dataci a posuzovana uroven je slozka
    not ( $level : Level( this!=$activeLevel ) and
         //DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $level.descItems and
         DescItem(type=="ZP2015_FOLDER_TYPE" && specCode=="ZP2015_FOLDER_LOGICAL" ) from $level.descItems and
         DescItem(type in ( "ZP2015_UNIT_DATE", "ZP2015_DATE_OTHER" )) from $level.descItems and
         DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER") ) from $descItem
         )    
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

// Datace - textová
rule "Datace - textová - man,inv,kat"
no-loop
when
    $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_MAN", "ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_UNIT_DATE") from $activeLevel.ownDescItems
    $itemType : RulItemTypeExt(code=="ZP2015_UNIT_DATE_TEXT")
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Datace - textová - starší"
no-loop
when
    $activeLevel: ActiveLevel( )
    not DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_MAN", "ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code=="ZP2015_UNIT_DATE_TEXT")
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $activeLevel.descItems
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

// Na kořeni je možné uvést vlastní časový rozsah fondu
rule "Vlastní časový rozsah fondu - ZP2015_UNIT_DATE_BULK"
no-loop
when
    $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ROOT") ) from $activeLevel.descItems
    $itemType : RulItemTypeExt(code=="ZP2015_UNIT_DATE_BULK")
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

// Standarní datace je doporučená pro poslední složku a část jednotlivosti (bez potomků)
rule "Datace - strojová - doporučení"
salience -100
no-loop
when
    $activeLevel: ActiveLevel( !hasChildren )
    $itemType : RulItemTypeExt(code in ( "ZP2015_UNIT_DATE" ) )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM") ) from $activeLevel.descItems

    // neexistje nadrizeny level typu logicka slozka s dataci
    not ( $level : Level( this!=$activeLevel ) and
         //DescItem(type=="ZP2015_LEVEL_TYPE" && specCode=="ZP2015_LEVEL_FOLDER" ) from $level.descItems and
         DescItem(type=="ZP2015_FOLDER_TYPE" && specCode=="ZP2015_FOLDER_LOGICAL" ) from $level.descItems and
         DescItem(type in ( "ZP2015_UNIT_DATE", "ZP2015_DATE_OTHER" )) from $level.descItems
         //DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM") ) from $descItem
         )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

// Povolení specifikací jiné datace označení
rule "Povolení vybraných jiných datací (ZP2015_DATE_OTHER)"
no-loop
when
    $itemType : RulItemTypeExt(code == "ZP2015_DATE_OTHER")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_DATE_OF_CONTENT",
    "ZP2015_DATE_DECLARED", "ZP2015_DATE_ORIG", "ZP2015_DATE_OF_COPY", "ZP2015_DATE_SEALING",
    "ZP2015_DATE_ACT_PUBLISHING", "ZP2015_DATE_INSERT", "ZP2015_DATE_MOLD_CREATION",
    "ZP2015_DATE_PUBLISHING", "ZP2015_DATE_CAPTURING")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Doporučené prvky pro první nastavení typu pomůcky (všechny typy)"
no-loop
salience -100
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in (
        "ZP2015_ARRANGEMENT_OTHER", "ZP2015_ARRANGEMENT_MAN", "ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT"
        ) ) from $activeLevel.descItems
    // nesmi existovat rodic, ktery by mel jiz vyhodnoceni nastaveno
    not ( $level: Level( this!=$activeLevel && $parentItems: descItems ) and
         DescItem(type in ( "ZP2015_ARRANGEMENT_TYPE" ) )
          from $level.descItems )    
    $itemType: RulItemTypeExt( code in (
        // ZP4.3.3 Způsob uspořádání jednotky popisu
        "ZP2015_UNIT_ARR", 
        // 4.3.5 Přímý zdroj akvizice
        "ZP2015_UNIT_SOURCE",
        // 4.4.4 Fyzický stav jednotky popisu a technické požadavky 
        "ZP2015_UNIT_CURRENT_STATUS",
        // 4.7.1 Zpracovatel     
        "ZP2015_ARRANGER",
        // 4.7.1 Informace o zpracování
        "ZP2015_ARRANGEMENT_INFO",
        // 4.7.2 Pravidla zpracování jednotky popisu
        "ZP2015_ARRANGE_RULES", 
        // ZP4.7.3 Datum (data) popisu 
        "ZP2015_DESCRIPTION_DATE") )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Doporučené prvky pro první nastavení typu pomůcky (inv, kat)"
no-loop
salience -100
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in (
        "ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT"
        ) ) from $activeLevel.descItems
    // nesmi existovat rodic, ktery by mel jiz vyhodnoceni nastaveno
    not ( $level: Level( this!=$activeLevel && $parentItems: descItems ) and
         DescItem(type in ( "ZP2015_ARRANGEMENT_TYPE" ) )
          from $level.descItems )    
    $itemType: RulItemTypeExt( code in (
        // 4.3.4 Tematický popis jednotky popisu
        "ZP2015_UNIT_CONTENT"
        ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Doporučené prvky pro první nastavení typu pomůcky (inv, kat, starsi)"
no-loop
salience -100
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in (
        "ZP2015_ARRANGEMENT_OTHER", "ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT"
        ) ) from $activeLevel.descItems
    // nesmi existovat rodic, ktery by mel jiz vyhodnoceni nastaveno
    not ( $level: Level( this!=$activeLevel && $parentItems: descItems ) and
         DescItem(type in ( "ZP2015_ARRANGEMENT_TYPE" ) )
          from $level.descItems )    
    $itemType: RulItemTypeExt( code in (
        // ZP4.3.2 Dějiny jednotky popisu    
    	"ZP2015_UNIT_HIST" 
        ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Doporučení pro kořen inventáře a katalogu"
no-loop
salience -100
when $activeLevel: ActiveLevel( parent == null )
    $descItem : DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT") ) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in (
    	// ZP4.3.6 Budoucí přírůstky
    	"ZP2015_FUTURE_UNITS"
	) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

//----------------------------------------------
// Inventář 1958 - 2015
//----------------------------------------------

rule "Inventární číslo možné na všech úrovních starší pomůcky"
no-loop
when $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_OTHER")) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in (
        // Inventární číslo
        "ZP2015_INV_CISLO"
        ) )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Inventární číslo doporučené pro složky a jednotlivosti"
no-loop
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER", "ZP2015_LEVEL_ITEM") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_OTHER")) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in (
        // Inventární číslo
        "ZP2015_INV_CISLO"
        ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Související záznam s jinou EJ"
no-loop
when $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_OTHER")) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in (
        // Související záznam
        "ZP2015_CONNECTED_RECORD"
        ) )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Související záznam s jinou EJ - specifikace"
no-loop
when $activeLevel: ActiveLevel( )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_OTHER")) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in (
        // Související záznam
        "ZP2015_CONNECTED_RECORD"
        ) )
    $itemSpec: RulItemSpecExt( ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

//----------------------------------------------
// Inventář
//----------------------------------------------

// nejsou žádná společná nastavení pro inventář


//----------------------------------------------
// Katalog
//----------------------------------------------

rule "Doporučené prvky na úrovni jednotlivosti (i části) pro katalog"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems:ownDescItems )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.9 Díl, část, pořadí vydání jednotky popisu
        "ZP2015_PART",
        // ZP5.2.10 Jazyk
        "ZP2015_LANGUAGE"
        ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Doporučené prvky na úrovni jednotlivosti (i části) pro katalog, pokud neni listem"
no-loop
salience -100
when $activeLevel: ActiveLevel( hasChildren && $ownItems:ownDescItems)
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.4 Rozměry, hmotnost, velikost, množství 
        "ZP2015_SIZE", 
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT"
        ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinné prvky na úrovni jednotlivosti (i části) pro katalog, pokud je listem"
no-loop
salience -100
when $activeLevel: ActiveLevel( !hasChildren && $ownItems:ownDescItems )
    $descItem : DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.4 Rozměry, hmotnost, velikost, množství 
        "ZP2015_SIZE", 
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT"
        ) )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end


//----------------------------------------------
// Listiny
//----------------------------------------------

// Doporučení pro listiny (vždy)
rule "Doporučení pro listiny (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems:ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    $itemType: RulItemTypeExt( code in ("ZP2015_STORAGE_COND", "ZP2015_SIZE", "ZP2015_ITEM_MAT",
        // ZP5.2.10 Jazyk 
        "ZP2015_LANGUAGE", "ZP2015_IMPRINT_COUNT",
        "ZP2015_ENTITY_ROLE") )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

// RE_008 Listiny
rule "RE_008_01 Listiny - možné role (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems 
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // pečetitelé 
        "ZP2015_ENTITY_ROLE_17",
        // příjemci 
        "ZP2015_ENTITY_ROLE_21",
        // žadatelé
        "ZP2015_ENTITY_ROLE_22",
        // svědci
        "ZP2015_ENTITY_ROLE_46",
        // ručitelé (rukojmě)
        "ZP2015_ENTITY_ROLE_47",
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // mista vydani
        "ZP2015_ENTITY_ROLE_58",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"        
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "Povinnost prvku pro listiny v inv"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ("ZP2015_STORAGE_COND", "ZP2015_SIZE", 
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT",
        // ZP5.2.10 Jazyk
        "ZP2015_LANGUAGE",
        // ZP5.7.4 Počet otisků původní a současný 
        "ZP2015_IMPRINT_COUNT",
        // nastaveni vztahu
        "ZP2015_ENTITY_ROLE"
    ) )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro listiny (cast jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ("ZP2015_STORAGE_COND", "ZP2015_SIZE", 
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT",
        // ZP5.2.10 Jazyk
        "ZP2015_LANGUAGE",
        // ZP5.7.4 Počet otisků původní a současný 
        "ZP2015_IMPRINT_COUNT",
        // nastaveni vztahu
        "ZP2015_ENTITY_ROLE"
    ) )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro listiny v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.3 Způsob a forma dochování
        "ZP2015_STORAGE_COND",
        // ZP5.7.4 Počet otisků původní a současný
        "ZP2015_IMPRINT_COUNT",
        // nastaveni vztahu
        "ZP2015_ENTITY_ROLE"
    ) )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

rule "RE_008_02 Listiny - povinné role v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // pečetitelé 
        "ZP2015_ENTITY_ROLE_17",
        // příjemci 
        "ZP2015_ENTITY_ROLE_21",
        // mista vydani
        "ZP2015_ENTITY_ROLE_58"
         ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end

rule "RE_008_03 Listiny - doporučené role v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // žadatel
        "ZP2015_ENTITY_ROLE_22"
         ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_008_04 Listiny - doporučené role pro listiny v inv (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // pečetitelé 
        "ZP2015_ENTITY_ROLE_17",
        // příjemci 
        "ZP2015_ENTITY_ROLE_21",
        // žadatelé
        "ZP2015_ENTITY_ROLE_22",
        // mista vydani
        "ZP2015_ENTITY_ROLE_58"
         ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_008_05 Listiny - povinné role entit v kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // pečetitelé
        "ZP2015_ENTITY_ROLE_17",
        // příjemci 
        "ZP2015_ENTITY_ROLE_21",
        // svědek
        "ZP2015_ENTITY_ROLE_46",
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // mista vydani
        "ZP2015_ENTITY_ROLE_58",
        // místa vzniku
        "ZP2015_ENTITY_ROLE_61"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end

rule "RE_008_06 Listiny - doporučené role entit v kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_LIO", "ZP2015_UNIT_TYPE_LIP") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // žadatelé
        "ZP2015_ENTITY_ROLE_22",
        // ručitelé (rukojmě)
        "ZP2015_ENTITY_ROLE_47",
		// místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// UKN, KTT, reg.pom.
//----------------------------------------------

// Pokud je kartoteka a neni nad ni slozka s hromadinou nebo s poctem EJ,
// tak se musi pocet EJ zobrazit primo u kartoteky
rule "Počet zásuvek pro KTT"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KTT") ) from $ownItems
    // Rodič není samostatná EJ
    not (
      DescItem(type=="ZP2015_FOLDER_TYPE" && specCode in ("ZP2015_FOLDER_UNITS", "ZP2015_FOLDER_SINGLE_TYPE")) from $activeLevel.descItems
    )
    // neni pevne spojeni
    not DescItem(type=="ZP2015_ITEM_LINK") from $activeLevel.descItems
    
    $itemType: RulItemTypeExt( code in ("ZP2015_UNIT_COUNT") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// Povolení kartotéčních lístků a zásuvek
// jen pokud je rodič KTT
rule "Možné části pro KTT"
no-loop
when
    $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // rodič je jednotlivost typu KTT
    $level: Level(this!=$activeLevel)
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KTT") ) from $level.ownDescItems
    $itemType : RulItemTypeExt(code == "ZP2015_UNIT_TYPE")
    $itemSpec : RulItemSpecExt(code in (
        // Kartotéční zásuvka
        "ZP2015_UNIT_TYPE_KTT_BOX",
        // Kartotéční lístek
        "ZP2015_UNIT_TYPE_KTT_ITEM"    
         ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end


// Povinné prvky pro UKN, KTT, reg.pom. (KAT)
rule "Povinné prvky pro UKN, KTT, reg.pom. (KAT)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PPR", "ZP2015_UNIT_TYPE_IND",
        "ZP2015_UNIT_TYP_ELE", "ZP2015_UNIT_TYPE_REP",
        "ZP2015_UNIT_TYPE_UKN", "ZP2015_UNIT_TYPE_KTT") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end


// RE_009 Úřední knihy, registraturní pomůcky, kartotéky
// Možné role entit pro UKN, KTT, reg.pom. (vždy)
rule "RE_009_01 Možné role entit pro UKN, KTT, reg.pom. (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PPR", "ZP2015_UNIT_TYPE_IND",
        "ZP2015_UNIT_TYP_ELE", "ZP2015_UNIT_TYPE_REP",
        "ZP2015_UNIT_TYPE_UKN", "ZP2015_UNIT_TYPE_KTT") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
		// místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_009_02 Povinne role pro UKN, KTT, reg.pom. v kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PPR", "ZP2015_UNIT_TYPE_IND",
        "ZP2015_UNIT_TYP_ELE", "ZP2015_UNIT_TYPE_REP",
        "ZP2015_UNIT_TYPE_UKN", "ZP2015_UNIT_TYPE_KTT") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři textu
        "ZP2015_ENTITY_ROLE_11",
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61"        
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_009_03 Doporucene role pro UKN, KTT, reg.pom. v kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PPR", "ZP2015_UNIT_TYPE_IND",
        "ZP2015_UNIT_TYP_ELE", "ZP2015_UNIT_TYPE_REP",
        "ZP2015_UNIT_TYPE_UKN", "ZP2015_UNIT_TYPE_KTT") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
		// tvůrci výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
		// místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"        
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// UKN - Matriky
//----------------------------------------------
rule "Možné prvky pro Matriky"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $items
    $itemType: RulItemTypeExt( code in (
         "ZP2015_UNIT_DATE"
       ) )    
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Možné prvky pro Matriky - opakovatelné"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $items
    $itemType: RulItemTypeExt( code in (
        "ZP2015_RECORD_TYPE", "ZP2015_ENTITY_ROLE", "ZP2015_OTHER_ID"
       ) )    
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
    $itemType.setRepeatable(true);
end

rule "Možné specifikace pro Matriky"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $items
    $itemType: RulItemTypeExt( code in (
        "ZP2015_RECORD_TYPE"
       ) )    
    $itemSpec: RulItemSpecExt( code in (
     	"ZP2015_RECORD_TYPE_BORN", "ZP2015_RECORD_TYPE_DIED", "ZP2015_RECORD_TYPE_MARRIED",
     	"ZP2015_RECORD_TYPE_INDEX_BORN", "ZP2015_RECORD_TYPE_INDEX_DIED", "ZP2015_RECORD_TYPE_INDEX_MARRIED") 
     	) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Doporučená signatura původce pro Matriky"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $items
    $itemType: RulItemTypeExt( code in (
        "ZP2015_OTHER_ID"
       ) )    
    $itemSpec: RulItemSpecExt( code in ("ZP2015_OTHERID_SIG_ORIG")
     	) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.RECOMMENDED);
end

// RE_010 Matriky
rule "RE_010_01 Možné role entit pro Matriky"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
		// místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
		// matriční místo
        "ZP2015_ENTITY_ROLE_82"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_010_02 Doporučené role entit pro Matriky v INV"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
		// matriční místo
        "ZP2015_ENTITY_ROLE_82"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_010_03 Povinné role entit pro Matriky v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_010_04 Doporučené role entit pro Hudebniny v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_MTR") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
		// místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
		// matriční místo
        "ZP2015_ENTITY_ROLE_82"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end


//----------------------------------------------
// Rukopisy
//----------------------------------------------

rule "Možné prvky pro Rukopisy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF"
       ) )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

// RE_011 Rukopisy bez hudebnin
rule "RE_011_01 Rukopisy bez hudebnin - vždy možné role entit"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři textu
        "ZP2015_ENTITY_ROLE_11",
        // objednatelé / příjemci
        "ZP2015_ENTITY_ROLE_19",
        // tvůrci výtvarné stránky 
        "ZP2015_ENTITY_ROLE_39",
        // překladatelé
        "ZP2015_ENTITY_ROLE_44",
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // vlastník
        "ZP2015_ENTITY_ROLE_85"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "Doporučené prvky pro Rukopisy v inv a kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF"
        ) )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro Rukopisy v inv"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro Rukopisy v inv (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF",    
        "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro Rukopisy v kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

rule "RE_011_02 Rukopisy bez hudebnin - povinné role entit v INV"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři textu
        "ZP2015_ENTITY_ROLE_11",
        // tvůrci výtvarné stránky 
        "ZP2015_ENTITY_ROLE_39"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end

rule "RE_011_03 Rukopisy bez hudebnin - povinné role v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři textu
        "ZP2015_ENTITY_ROLE_11",
        // objednatelé / příjemci
        "ZP2015_ENTITY_ROLE_19",
        // tvůrci výtvarné stránky 
        "ZP2015_ENTITY_ROLE_39",
        // překladatel 
        "ZP2015_ENTITY_ROLE_44",
        // písař
        "ZP2015_ENTITY_ROLE_48",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // vlastník
        "ZP2015_ENTITY_ROLE_85"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.REQUIRED);
end

rule "RE_011_04 Rukopisy bez hudebnin - doporučené role v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_RKP") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // místo vzniku předlohy popisované kopie
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Hudebniny
//----------------------------------------------

// RE_012 Hudebniny
rule "RE_012_01 Možné role entit pro Hudebniny"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé / nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // autoři hudební složky
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky
        "ZP2015_ENTITY_ROLE_10",
        // autoři doprovodných textů
        "ZP2015_ENTITY_ROLE_3",
        // objednatelé / příjemci 
        "ZP2015_ENTITY_ROLE_19",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // opisovač
        "ZP2015_ENTITY_ROLE_84"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_012_02 Povinné role entit pro Hudebniny v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři hudební složky
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky
        "ZP2015_ENTITY_ROLE_10",        
        // objednatelé / příjemci 
        "ZP2015_ENTITY_ROLE_19",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_012_03 Doporučené role entit pro Hudebniny v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_012_04 Doporučené role entit pro Hudebniny v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autoři hudební složky
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky
        "ZP2015_ENTITY_ROLE_10",        
        // objednatelé / příjemci 
        "ZP2015_ENTITY_ROLE_19",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_012_05 Povinné role entit pro Hudebniny v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé / nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // autoři hudební složky
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky
        "ZP2015_ENTITY_ROLE_10",        
        // autoři doprovodných textů
        "ZP2015_ENTITY_ROLE_3",
        // objednatelé / příjemci 
        "ZP2015_ENTITY_ROLE_19",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // opisovač
        "ZP2015_ENTITY_ROLE_84"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_012_06 Doporučené role entit pro Hudebniny v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
		// místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"       
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//-------
// Typáře
//-------

// Možné prvky pro Typáře (vždy)
rule "Možné prvky pro Typáře (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ",
        "ZP2015_UNIT_TYPE_OTD", "ZP2015_UNIT_TYPE_OTC"
        ) ) from $ownItems
    $itemType: RulItemTypeExt( code in (
        // ZP5.7.1 Opis, nápis, exerque
        "ZP2015_EXERQUE",
        // ZP5.7.2 Popis obrazu v poli typáře či otisku
        "ZP2015_PAINTING_CHAR",
        // ZP5.7.3 Koroborace dokumentu, k němuž byl popisovaný otisk připojen
        "ZP2015_CORROBORATION",
        // ZP5.7.4 Počet otisků původní a současný
        "ZP2015_IMPRINT_COUNT",
        // ZP5.7.5 Pořadí otisku,
        "ZP2015_IMPRINT_ORDER"
        ) )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "Povolení vybraných jiných datací (ZP2015_DATE_OTHER) pro typáře"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    $itemType : RulItemTypeExt(code == "ZP2015_DATE_OTHER")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_DATE_USAGE")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

// RE_013 Typáře
rule "RE_013_01 Možné role entit pro typáře"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // výrobce
        "ZP2015_ENTITY_ROLE_53",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

// RE_014 Otisky typářů
rule "RE_014_01 Možné role entit pro otisky"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTD" ) ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vydání
        "ZP2015_ENTITY_ROLE_58"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

// RE_015 Kopie otisků typářů
rule "RE_015_01 Možné role entit pro kopie otisků"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTC" ) ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // výrobce
        "ZP2015_ENTITY_ROLE_53",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "Povinnost prvku pro typáře a kopie otisků v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
                   "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ", "ZP2015_UNIT_TYPE_OTC"
    ) ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.10 Jazyk, písmo
        "ZP2015_LANGUAGE",
        "ZP2015_ENTITY_ROLE" 
    ) )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro otisky v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
                   "ZP2015_UNIT_TYPE_OTD"
    ) ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.3 Způsob a forma dochování
        "ZP2015_STORAGE_COND",
        // ZP5.2.10 Jazyk, písmo
        "ZP2015_LANGUAGE",
        "ZP2015_ENTITY_ROLE" 
    ) )
then
  $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro otisky v inv (část jednotlivosti)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
                   "ZP2015_UNIT_TYPE_OTD"
    ) ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.3 Způsob a forma dochování
        "ZP2015_STORAGE_COND",
        // ZP5.2.10 Jazyk, písmo
        "ZP2015_LANGUAGE",
        "ZP2015_ENTITY_ROLE" 
    ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro pečetidla, razítka v kat (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
                   "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ"
    ) ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.7.1 Opis, nápis, exerque
        "ZP2015_EXERQUE",
        // ZP5.7.2 Popis obrazu v poli typáře či otisku
        "ZP2015_PAINTING_CHAR",
        "ZP2015_ENTITY_ROLE"        
    ) )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro pečetidla, razítka v kat (část jednotlivosti)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
                   "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ"
    ) ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.7.1 Opis, nápis, exerque
        "ZP2015_EXERQUE",
        // ZP5.7.2 Popis obrazu v poli typáře či otisku
        "ZP2015_PAINTING_CHAR",
        "ZP2015_ENTITY_ROLE"        
    ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro samostatné pečetě a kopie otisků v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
                   "ZP2015_UNIT_TYPE_OTD", "ZP2015_UNIT_TYPE_OTC"
    ) ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.7.1 Opis, nápis, exerque
        "ZP2015_EXERQUE",
        // ZP5.7.2 Popis obrazu v poli typáře či otisku
        "ZP2015_PAINTING_CHAR",
        // ZP5.7.3 Koroborace dokumentu, k němuž byl popisovaný otisk připojen
        "ZP2015_CORROBORATION",
        // ZP5.7.5 Pořadí otisku,
        "ZP2015_IMPRINT_ORDER",
        "ZP2015_ENTITY_ROLE" 
    ) )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinné prvky pro otisky v KAT (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
                   "ZP2015_UNIT_TYPE_OTD"
    ) ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.3 Způsob a forma dochování
        "ZP2015_STORAGE_COND"
    ) )
then
  $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "RE_013_02 Povinné role entit pro typáře v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_013_03 Doporučené role entit pro typáře v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_013_04 Povinné role entit pro typáře v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // výrobce
        "ZP2015_ENTITY_ROLE_53",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_013_05 Doporučené role entit pro typáře v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_PEC", "ZP2015_UNIT_TYPE_RAZ") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_014_02 Povinné role entit pro otisky v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTD") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_014_03 Doporučené role entit pro otisky v INV (část jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTD") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_014_04 Povinné role entit pro otisky v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTD") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vydání
        "ZP2015_ENTITY_ROLE_58"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_015_02 Povinné role entit pro kopie otisků v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTC") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_015_03 Doporučenné role entit pro kopie otisků v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTC") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_015_04 Doporučené role entit pro kopie otisků v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTC") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_015_05 Povinné role entit pro kopie otisků v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in (
        "ZP2015_UNIT_TYPE_OTC") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // majitelé typářů
        "ZP2015_ENTITY_ROLE_37",
        // výrobce
        "ZP2015_ENTITY_ROLE_53",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

//----------------------------------------------
// Mapy
//----------------------------------------------

// Možné prvky pro mapy (vždy)
rule "Možné prvky pro mapy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF",    
        "ZP2015_POSITION",
        "ZP2015_ORIENTATION") )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "Povolení vybraných jiných datací (ZP2015_DATE_OTHER) pro mapy"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    $itemType : RulItemTypeExt(code == "ZP2015_DATE_OTHER")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_DATE_MAP_UPDATE")) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "Povinnost prvku pro mapy v inv (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ("ZP2015_POSITION", "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

rule "Doporučené prvky pro mapy v inv (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ("ZP2015_POSITION", "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro mapy v kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_POSITION", "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

// Měřítko
rule "Možné textové měřítko pro mapy a tech. výkresy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL", "ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    $itemType: RulItemTypeExt( code in ("ZP2015_SCALE") )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "Možné strukturované měřítko pro mapy a tech. výkresy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL", "ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    $itemType: RulItemTypeExt( code in ("ZP2015_SCALE_NUMERICAL") )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
    $itemType.setRepeatable(true);
end

rule "Povinnost měřítka pro mapy a tech. výkresy v inv (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL", "ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    not DescItem(type=="ZP2015_SCALE") from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ("ZP2015_SCALE_NUMERICAL" ) )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end

rule "Doporučené měřítko pro mapy a tech. výkr. v inv (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL", "ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    not DescItem(type=="ZP2015_SCALE") from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ("ZP2015_SCALE_NUMERICAL" ) )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost měřítka pro mapy a tech. výkresy v kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL", "ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    not DescItem(type=="ZP2015_SCALE") from $ownItems
    // Rodic je INV nebo KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_SCALE_NUMERICAL" ) )
then
    $itemType.setMinType(RulItemType.Type.REQUIRED);
end



// RE_016 Mapy, mapová díla, atlasy
rule "RE_016_01 Možné role entit pro mapy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé/nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // objednatelé/příjemci
        "ZP2015_ENTITY_ROLE_19",
        // kartografové
        "ZP2015_ENTITY_ROLE_33",
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // redaktoři
        "ZP2015_ENTITY_ROLE_32",
        // editoři
        "ZP2015_ENTITY_ROLE_34",
        // kresliči
        "ZP2015_ENTITY_ROLE_36",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // tvůrci technického zpracování
        "ZP2015_ENTITY_ROLE_38",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_016_02 Povinné role entit pro mapy v INV"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé/nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // kartografové
        "ZP2015_ENTITY_ROLE_33"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_016_03 Doporučené role entit pro mapy v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé/nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // kartografové
        "ZP2015_ENTITY_ROLE_33"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_016_04 Povinné role entit pro mapy v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé/nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // objednatelé/příjemci
        "ZP2015_ENTITY_ROLE_19",
        // kartografové
        "ZP2015_ENTITY_ROLE_33",
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // redaktoři
        "ZP2015_ENTITY_ROLE_32",
        // editoři
        "ZP2015_ENTITY_ROLE_34",
        // kresliči
        "ZP2015_ENTITY_ROLE_36",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // tvůrci technického zpracování
        "ZP2015_ENTITY_ROLE_38",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_016_05 Doporučené role entit pro mapy v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_MAP", "ZP2015_UNIT_TYPE_ATL") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
		// místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Technické výkresy
//----------------------------------------------

// Možné prvky pro technické výkresy (vždy)
rule "Možné prvky pro technické výkresy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    $itemType: RulItemTypeExt( code in (
      // ZP5.2.2 Název autorského díla
      "ZP2015_ITEM_TITLE_REF",
      "ZP2015_POSITION", 
      "ZP2015_ORIENTATION") )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Povinnost prvku pro technické výkresy v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV nebo KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Doporučené prvky pro technické výkresy v inv (část jednotlivosti)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro technické výkresy v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_017 Technické výkresy
rule "RE_017_01 Možné role entit pro technické výkresy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // objednatelé/příjemci 
        "ZP2015_ENTITY_ROLE_19",
        // autor
        "ZP2015_ENTITY_ROLE_1",
        // schvalovatelé
        "ZP2015_ENTITY_ROLE_25",
        // stavitelé
        "ZP2015_ENTITY_ROLE_26",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // kresliči
        "ZP2015_ENTITY_ROLE_36",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // typová označení a názvy výrobků a typových staveb
        "ZP2015_ENTITY_ROLE_63"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_017_02 Povinné role entit pro technické výkresy v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // autor
        "ZP2015_ENTITY_ROLE_1", 
        // objednatelé/příjemci 
        "ZP2015_ENTITY_ROLE_19"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end


rule "RE_017_03 Doporučené role entit pro technické výkresy v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // autor
        "ZP2015_ENTITY_ROLE_1",
        // objednatelé/příjemci 
        "ZP2015_ENTITY_ROLE_19"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_017_04 Povinné role entit pro technické výkresy v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autor
        "ZP2015_ENTITY_ROLE_1",
        // objednatelé/příjemci 
        "ZP2015_ENTITY_ROLE_19",
        // schvalovatelé
        "ZP2015_ENTITY_ROLE_25",
        // stavitelé
        "ZP2015_ENTITY_ROLE_26",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // kresliči
        "ZP2015_ENTITY_ROLE_36",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // typová označení a názvy výrobků a typových staveb
        "ZP2015_ENTITY_ROLE_63"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_017_05 Doporučené role entit pro technické výkresy v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TVY") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
		// místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Grafické listy a kresby
//----------------------------------------------

// Možné prvky pro Grafické listy a kresby (vždy)
rule "Možné prvky pro Grafické listy a kresby (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    $itemType: RulItemTypeExt( code in (
        // ZP5.11.1 Legenda
        "ZP2015_LEGEND",
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF",        
        // ZP5.2.6 Souřadnice - tvar a souřadnice
        "ZP2015_POSITION", 
        // ZP5.2.7 Orientace z hlediska světových stran
        "ZP2015_ORIENTATION") )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

// RE_018 Grafické listy, kresby
rule "RE_018_01 Možné role entit pro Grafické listy a kresby (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé / nakladatelé 
        "ZP2015_ENTITY_ROLE_16",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // tvůrci technického zpracování
        "ZP2015_ENTITY_ROLE_38",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "Povinnost prvku pro Grafické listy a kresby v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        "ZP2015_ENTITY_ROLE"    ) )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro Grafické listy a kresby v inv (část jednotlivosti)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        "ZP2015_ENTITY_ROLE"    ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro Grafické listy a kresby v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        // ZP5.11.1 Legenda
        "ZP2015_LEGEND",  "ZP2015_ENTITY_ROLE"  ) )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "RE_018_02 Povinné role entit Grafické listy a kresby v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // tvůrci technického zpracování
        "ZP2015_ENTITY_ROLE_38",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39"        
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_018_03 Doporučené role entit Grafické listy a kresby v INV (část jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // tvůrci technického zpracování
        "ZP2015_ENTITY_ROLE_38",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39"        
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_018_04 Povinné role entit Grafické listy a kresby v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // vydavatelé / nakladatelé 
        "ZP2015_ENTITY_ROLE_16",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // tvůrci technického zpracování
        "ZP2015_ENTITY_ROLE_38",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",        
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_018_05 Doporučené role entit Grafické listy a kresby v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_GLI", "ZP2015_UNIT_TYPE_KRE") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Fotografické archivalie
//----------------------------------------------

// Možné prvky pro fotograficky material (vždy)
rule "Možné prvky pro fotograficky material (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_FAL", "ZP2015_UNIT_TYPE_DFO") ) from $ownItems
    $itemType: RulItemTypeExt( code in ("ZP2015_ORIENTATION",
        "ZP2015_POSITION") )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

// viz https://bugzilla.lightcomp.cz/show_bug.cgi?id=4683
/*
rule "Doporučené prvky pro fotograficky material v inv (složka)"
no-loop
salience -100
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_FAL", "ZP2015_UNIT_TYPE_DFO") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
       // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
       "ZP2015_ITEM_MAT",
       "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end
*/

rule "Povinnost prvku pro fotograficky material v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_FAL", "ZP2015_UNIT_TYPE_DFO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
       // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
       "ZP2015_ITEM_MAT") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro fotograficky material v inv (část jednotlivosti)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_FAL", "ZP2015_UNIT_TYPE_DFO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
       // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
       "ZP2015_ITEM_MAT") )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro fotograficky material v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_FAL", "ZP2015_UNIT_TYPE_DFO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_019 a RE_020 Fotografické archiválie včetně fotoalb
rule "RE_019_01 a RE_020_01 Možné role entit pro fotografický materiál včetně fotoalb (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_FAL", "ZP2015_UNIT_TYPE_DFO") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // fotograf
        "ZP2015_ENTITY_ROLE_31",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // odesílatelé
        "ZP2015_ENTITY_ROLE_24",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místo fotografování
        "ZP2015_ENTITY_ROLE_86",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_019_02 Povinné role entit pro fotograficky material bez fotoalb v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_DFO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // fotograf
        "ZP2015_ENTITY_ROLE_31",
        // místo fotografování
        "ZP2015_ENTITY_ROLE_86"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_019_03 Doporučené role entit pro fotograficky material bez fotoalb v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_DFO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // fotograf
        "ZP2015_ENTITY_ROLE_31",
        // místo fotografování
        "ZP2015_ENTITY_ROLE_86"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_020_02 Doporučené role entit pro fotoalba v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FAL") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // fotograf
        "ZP2015_ENTITY_ROLE_31",
        // místo fotografování
        "ZP2015_ENTITY_ROLE_86"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_019_04 a RE_020_03 Povinné role entit pro fotograficky material včetně fotoalb v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_FSN", "ZP2015_UNIT_TYPE_FSD",
    "ZP2015_UNIT_TYPE_LFI", "ZP2015_UNIT_TYPE_SFI", "ZP2015_UNIT_TYPE_KIN", "ZP2015_UNIT_TYPE_MF", "ZP2015_UNIT_TYPE_MFS",
    "ZP2015_UNIT_TYPE_FAL", "ZP2015_UNIT_TYPE_DFO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems )
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // fotograf
        "ZP2015_ENTITY_ROLE_31",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // odesílatelé
        "ZP2015_ENTITY_ROLE_24",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // místo fotografování
        "ZP2015_ENTITY_ROLE_86",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

//----------------------------------------------
// Kinematografické filmy
//----------------------------------------------

rule "Možné prvky pro Kinematografické filmy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $ownItems
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF",
        // ZP5.13.1 Délka filmového záznamu
        "ZP2015_MOVIE_LENGTH") )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Povolení vybraných jiných datací (ZP2015_DATE_OTHER) pro Kinematografické filmy"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $ownItems
    $itemType : RulItemTypeExt(code == "ZP2015_DATE_OTHER")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_DATE_RECORDING")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

// Odstraneno, viz https://bugzilla.lightcomp.cz/show_bug.cgi?id=4683
/*
rule "Doporučené prvky pro Kinematografické filmy v inv (složka)"
no-loop
salience -100
when $activeLevel: ActiveLevel( )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $activeLevel.descItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_FOLDER") ) from $activeLevel.descItems
    // Rodic je INV 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF",    
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT", 
        // ZP5.13.1 Délka filmového záznamu
        "ZP2015_MOVIE_LENGTH",
        "ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end
*/

rule "Doporučené prvky pro Kinematografické filmy v inv, kat (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems    
    // Rodic je INV 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF") )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end


rule "Povinnost prvku pro Kinematografické filmy v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems    
    // Rodic je INV 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT", 
        // ZP5.13.1 Délka filmového záznamu
        "ZP2015_MOVIE_LENGTH",
        "ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro Kinematografické filmy v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        // ZP5.13.1 Délka filmového záznamu
        "ZP2015_MOVIE_LENGTH",
        "ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_021 Kinematografické filmy
rule "RE_021_01 Možné role entit pro Kinematografické filmy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // produkční společnosti/producenti 
        "ZP2015_ENTITY_ROLE_18",
        // objednatelé / příjemci
        "ZP2015_ENTITY_ROLE_19",
        // distributoři
        "ZP2015_ENTITY_ROLE_20",
        // režiséři
        "ZP2015_ENTITY_ROLE_27",
        // scénáristé
        "ZP2015_ENTITY_ROLE_28",
        // kameramani
        "ZP2015_ENTITY_ROLE_29",
        // autoři námětů
        "ZP2015_ENTITY_ROLE_9",
        // autoři dialogů
        "ZP2015_ENTITY_ROLE_2",
        // autoři hudby
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky / textaři
        "ZP2015_ENTITY_ROLE_10",
        // autoři komentářů
        "ZP2015_ENTITY_ROLE_8",
        // autoři choreografií
        "ZP2015_ENTITY_ROLE_7",
        // autoři triků a speciálních efektů
        "ZP2015_ENTITY_ROLE_12",
        // interpreti hudby
        "ZP2015_ENTITY_ROLE_30",
        // tvůrci výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // dramaturgové
        "ZP2015_ENTITY_ROLE_40",
        // střih
        "ZP2015_ENTITY_ROLE_41",
        // zvuk
        "ZP2015_ENTITY_ROLE_42",
        // účinkující
        "ZP2015_ENTITY_ROLE_43",
        // překladatelé
        "ZP2015_ENTITY_ROLE_44",
        // zpracovatelé nosičů záznamů
        "ZP2015_ENTITY_ROLE_49",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // místa vzniku záznamů
        "ZP2015_ENTITY_ROLE_56",
        // místa výroby jednotek popisu
        "ZP2015_ENTITY_ROLE_60",
        // odborná spolupráce
        "ZP2015_ENTITY_ROLE_87",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_021_02 Povinné role entit pro Kinematografické filmy v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // produkční společnosti/producenti 
        "ZP2015_ENTITY_ROLE_18",
        // režiséři
        "ZP2015_ENTITY_ROLE_27",
        // scénáristé
        "ZP2015_ENTITY_ROLE_28",
        // kameramani
        "ZP2015_ENTITY_ROLE_29",
        // autoři námětů
        "ZP2015_ENTITY_ROLE_9",
        // autoři dialogů
        "ZP2015_ENTITY_ROLE_2",
        // autoři hudby
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky / textaři
        "ZP2015_ENTITY_ROLE_10"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_021_03 Povinné role entit pro Kinematografické filmy v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_KZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // produkční společnosti/producenti 
        "ZP2015_ENTITY_ROLE_18",
        // objednatelé / příjemci
        "ZP2015_ENTITY_ROLE_19",
        // distributoři
        "ZP2015_ENTITY_ROLE_20",
        // režiséři
        "ZP2015_ENTITY_ROLE_27",
        // scénáristé
        "ZP2015_ENTITY_ROLE_28",
        // kameramani
        "ZP2015_ENTITY_ROLE_29",
        // autoři námětů
        "ZP2015_ENTITY_ROLE_9",
        // autoři dialogů
        "ZP2015_ENTITY_ROLE_2",
        // autoři hudby
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky / textaři
        "ZP2015_ENTITY_ROLE_10",
        // autoři komentářů
        "ZP2015_ENTITY_ROLE_8",
        // autoři choreografií
        "ZP2015_ENTITY_ROLE_7",
        // autoři triků a speciálních efektů
        "ZP2015_ENTITY_ROLE_12",
        // interpreti hudby
        "ZP2015_ENTITY_ROLE_30",
        // tvůrci výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // dramaturgové
        "ZP2015_ENTITY_ROLE_40",
        // střih
        "ZP2015_ENTITY_ROLE_41",
        // zvuk
        "ZP2015_ENTITY_ROLE_42",
        // účinkující
        "ZP2015_ENTITY_ROLE_43",
        // překladatelé
        "ZP2015_ENTITY_ROLE_44",
        // zpracovatelé nosičů záznamů
        "ZP2015_ENTITY_ROLE_49",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // místa vzniku záznamů
        "ZP2015_ENTITY_ROLE_56",
        // místa výroby jednotek popisu
        "ZP2015_ENTITY_ROLE_60",
        // odborná spolupráce
        "ZP2015_ENTITY_ROLE_87",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

//----------------------------------------------
// Zvukové archiválie
//----------------------------------------------

rule "Možné prvky pro Zvukové záznamy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_ZZA") ) from $ownItems
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF",
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT", 
        // ZP5.14.1 Délka zvukového záznamu
        "ZP2015_RECORD_LENGTH") )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Povolení vybraných jiných datací (ZP2015_DATE_OTHER) pro Zvukové záznamy"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_ZZA") ) from $ownItems
    $itemType : RulItemTypeExt(code == "ZP2015_DATE_OTHER")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_DATE_RECORDING")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Doporučenné prvky pro Zvukové záznamy v inv, kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_ZZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF") )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro Zvukové záznamy v inv"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_ZZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
        "ZP2015_ITEM_MAT", 
        // ZP5.14.1 Délka zvukového záznamu
        "ZP2015_RECORD_LENGTH",
        "ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro Zvukové záznamy v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_ZZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in (
        // ZP5.14.1 Délka zvukového záznamu
        "ZP2015_RECORD_LENGTH",
        "ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_022 Zvukové archiválie
rule "RE_022_01 Možné role entit pro Zvukové záznamy (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_ZZA") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // produkční společnosti/producenti 
        "ZP2015_ENTITY_ROLE_18",
        // objednatelé / příjemci
        "ZP2015_ENTITY_ROLE_19",
        // distributoři
        "ZP2015_ENTITY_ROLE_20",
        // režiséři
        "ZP2015_ENTITY_ROLE_27",
        // scénáristé
        "ZP2015_ENTITY_ROLE_28",
        // autoři námětů
        "ZP2015_ENTITY_ROLE_9",
        // autoři dialogů
        "ZP2015_ENTITY_ROLE_2",
        // autoři hudby
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky / textaři
        "ZP2015_ENTITY_ROLE_10",
        // autoři komentářů
        "ZP2015_ENTITY_ROLE_8",
        // autoři triků a speciálních efektů
        "ZP2015_ENTITY_ROLE_12",
        // interpreti hudby
        "ZP2015_ENTITY_ROLE_30",
        // tvůrci výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // dramaturgové
        "ZP2015_ENTITY_ROLE_40",
        // střih
        "ZP2015_ENTITY_ROLE_41",
        // zvuk
        "ZP2015_ENTITY_ROLE_42",
        // účinkující
        "ZP2015_ENTITY_ROLE_43",
        // překladatelé
        "ZP2015_ENTITY_ROLE_44",
        // zpracovatelé nosičů záznamů
        "ZP2015_ENTITY_ROLE_49",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // místa vzniku záznamů
        "ZP2015_ENTITY_ROLE_56",
        // místa výroby jednotek popisu
        "ZP2015_ENTITY_ROLE_60",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_022_02 Povinné role entit pro Zvukové záznamy v INV"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_ZZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // produkční společnosti/producenti 
        "ZP2015_ENTITY_ROLE_18",
        // režiséři
        "ZP2015_ENTITY_ROLE_27",
        // scénáristé
        "ZP2015_ENTITY_ROLE_28",
        // autoři námětů
        "ZP2015_ENTITY_ROLE_9",
        // autoři dialogů
        "ZP2015_ENTITY_ROLE_2",
        // autoři hudby
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky / textaři
        "ZP2015_ENTITY_ROLE_10"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_022_03 Povinné role entit pro Zvukové záznamy v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_ZZA") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // produkční společnosti/producenti 
        "ZP2015_ENTITY_ROLE_18",
        // objednatelé / příjemci
        "ZP2015_ENTITY_ROLE_19",
        // distributoři
        "ZP2015_ENTITY_ROLE_20",
        // režiséři
        "ZP2015_ENTITY_ROLE_27",
        // scénáristé
        "ZP2015_ENTITY_ROLE_28",
        // autoři námětů
        "ZP2015_ENTITY_ROLE_9",
        // autoři dialogů
        "ZP2015_ENTITY_ROLE_2",
        // autoři hudby
        "ZP2015_ENTITY_ROLE_6",
        // autoři textové složky / textaři
        "ZP2015_ENTITY_ROLE_10",
        // autoři komentářů
        "ZP2015_ENTITY_ROLE_8",
        // autoři triků a speciálních efektů
        "ZP2015_ENTITY_ROLE_12",
        // interpreti hudby
        "ZP2015_ENTITY_ROLE_30",
        // tvůrci výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // dramaturgové
        "ZP2015_ENTITY_ROLE_40",
        // střih
        "ZP2015_ENTITY_ROLE_41",
        // zvuk
        "ZP2015_ENTITY_ROLE_42",
        // účinkující
        "ZP2015_ENTITY_ROLE_43",
        // překladatelé
        "ZP2015_ENTITY_ROLE_44",
        // zpracovatelé nosičů záznamů
        "ZP2015_ENTITY_ROLE_49",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // místa vzniku záznamů
        "ZP2015_ENTITY_ROLE_56",
        // místa výroby jednotek popisu
        "ZP2015_ENTITY_ROLE_60",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

//----------------------------------------------
// Tisky
//----------------------------------------------

rule "Možné prvky pro tisky (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	$itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF") )
then
	$itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Doporučené prvky pro tisky v inv, kat (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
	// Rodic je INV nebo KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF"
	    ) )
then
	$itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro tisky v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
	// Rodic je INV nebo KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in (
	    "ZP2015_ENTITY_ROLE") )
then
	$itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro tisky v inv (část jednotlivosti)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je INV nebo KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in (
        // ZP5.2.2 Název autorského díla
        "ZP2015_ITEM_TITLE_REF",
	    "ZP2015_ENTITY_ROLE") )
then
	$itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro tisky v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je INV nebo KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in (
	    "ZP2015_ENTITY_ROLE") )
then
	$itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_023 a RE_024 Tisky do roku 1800 a po roce 1800
rule "RE_023_01 a RE_024_01 Možné role entit pro tisky (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in (
		// vydavatelé/nakladatelé 
		"ZP2015_ENTITY_ROLE_16",
		// příjemci 
		"ZP2015_ENTITY_ROLE_21",		
		// autoři textu
		"ZP2015_ENTITY_ROLE_11",
		// fotografové
		"ZP2015_ENTITY_ROLE_31",
        // redaktor
        "ZP2015_ENTITY_ROLE_32",
        // editoři
        "ZP2015_ENTITY_ROLE_34",		
		// kartografové
		"ZP2015_ENTITY_ROLE_33",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",		
		// překladatelé
		"ZP2015_ENTITY_ROLE_44",
		// lektoři
		"ZP2015_ENTITY_ROLE_45",
		// výrobci nosičů záznamů
		"ZP2015_ENTITY_ROLE_50",
		// tiskárny/tiskaři
		"ZP2015_ENTITY_ROLE_52",
		// místa vydání
		"ZP2015_ENTITY_ROLE_58",
		// místa vzniku předloh popisovaných kopií
		"ZP2015_ENTITY_ROLE_62",
		// vlastník
		"ZP2015_ENTITY_ROLE_85"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_023_02 a RE_024_02 Povinné role entit pro tisky v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
	// Rodic je INV 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// vydavatelé/nakladatelé 
		"ZP2015_ENTITY_ROLE_16",
		// autoři textu
		"ZP2015_ENTITY_ROLE_11",
		// místa vydání
		"ZP2015_ENTITY_ROLE_58"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_023_03 a RE_024_03 Doporučené role entit pro tisky v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
	// Rodic je INV 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_023_04 a RE_024_04 Doporučené role entit pro tisky v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je INV 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// vydavatelé/nakladatelé 
		"ZP2015_ENTITY_ROLE_16",
		// autoři textu
		"ZP2015_ENTITY_ROLE_11",
		// místa vydání
		"ZP2015_ENTITY_ROLE_58",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_023_05 Povinné role entit pro tisky do roku 1800 v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// vydavatelé/nakladatelé 
		"ZP2015_ENTITY_ROLE_16",
		// příjemci 
		"ZP2015_ENTITY_ROLE_21",		
		// autoři textu
		"ZP2015_ENTITY_ROLE_11",
        // redaktor
        "ZP2015_ENTITY_ROLE_32",
        // editoři
        "ZP2015_ENTITY_ROLE_34",
		// kartografové
		"ZP2015_ENTITY_ROLE_33",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",		
		// překladatelé
		"ZP2015_ENTITY_ROLE_44",
		// lektoři
		"ZP2015_ENTITY_ROLE_45",
		// výrobci nosičů záznamů
		"ZP2015_ENTITY_ROLE_50",
		// tiskárny/tiskaři
		"ZP2015_ENTITY_ROLE_52",
		// místa vydání
		"ZP2015_ENTITY_ROLE_58",
		// vlastník
		"ZP2015_ENTITY_ROLE_85"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_024_05 Povinné role entit pro tisky po roce 1800 v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// vydavatelé/nakladatelé 
		"ZP2015_ENTITY_ROLE_16",
		// příjemci 
		"ZP2015_ENTITY_ROLE_21",		
		// autoři textu
		"ZP2015_ENTITY_ROLE_11",
		// fotografové
		"ZP2015_ENTITY_ROLE_31",
        // redaktor
        "ZP2015_ENTITY_ROLE_32",
        // editoři
        "ZP2015_ENTITY_ROLE_34",		
		// kartografové
		"ZP2015_ENTITY_ROLE_33",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",		
		// překladatelé
		"ZP2015_ENTITY_ROLE_44",
		// lektoři
		"ZP2015_ENTITY_ROLE_45",
		// výrobci nosičů záznamů
		"ZP2015_ENTITY_ROLE_50",
		// tiskárny/tiskaři
		"ZP2015_ENTITY_ROLE_52",
		// místa vydání
		"ZP2015_ENTITY_ROLE_58",
		// vlastník
		"ZP2015_ENTITY_ROLE_85"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_023_06 a RE_024_06 Doporučené role entit pro tisky v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_TIO", "ZP2015_UNIT_TYPE_TIP") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// místa vzniku předloh popisovaných kopií
		"ZP2015_ENTITY_ROLE_62"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Pohlednice
//----------------------------------------------

rule "Možné prvky pro Pohlednice (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_POH") ) from $ownItems
    $itemType: RulItemTypeExt( code in (
        // ZP5.2.6 Souřadnice - tvar a souřadnice
        "ZP2015_POSITION",
        // ZP5.2.7 Orientace z hlediska světových stran
        "ZP2015_ORIENTATION") )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

// Povinnost prvku pro Pohlednice v kat
rule "Povinnost prvku pro Pohlednice v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_POH") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_025 Pohlednice
rule "RE_025_01 Možné role entit pro Pohlednice (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_POH") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé / nakladatelé 
        "ZP2015_ENTITY_ROLE_16",
        // odesilatelé
        "ZP2015_ENTITY_ROLE_24",        
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vydání
        "ZP2015_ENTITY_ROLE_58",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
		// obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_025_02 Povinné role entit pro Pohlednice v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_POH") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
	// Rodic je INV 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_025_03 Doporučené role entit pro Pohlednice v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_POH") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je INV 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_025_04 Povinné role entit pro Pohlednice v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_POH") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // vydavatelé / nakladatelé 
        "ZP2015_ENTITY_ROLE_16",
        // odesilatelé
        "ZP2015_ENTITY_ROLE_24",        
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vydání
        "ZP2015_ENTITY_ROLE_58",
		// obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_025_05 Doporučené role entit pro Pohlednice v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_POH") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"     
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Plakáty
//----------------------------------------------

rule "Povinnost prvku pro Plakáty v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PKT") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_026 Plakáty
rule "RE_026_01 Možné role entit pro Plakáty (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PKT") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé / nakladatelé 
        "ZP2015_ENTITY_ROLE_16",
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",        
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",        
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vydání
        "ZP2015_ENTITY_ROLE_58",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_026_02 Povinné role entit pro Plakáty v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PKT") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // vydavatelé / nakladatelé 
        "ZP2015_ENTITY_ROLE_16",
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",        
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",        
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vydání
        "ZP2015_ENTITY_ROLE_58",
        // obrazově a/nebo zvukově zachycená entita
        "ZP2015_ENTITY_ROLE_89"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end


rule "RE_026_03 Doporučené role entit pro Plakáty v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PKT") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Štočky
//----------------------------------------------

// Povinnost prvku pro Štočky v kat
rule "Povinnost prvku pro Štočky v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_STO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_028 Štočky
rule "RE_028_01 Možné role entit pro Štočky (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_STO") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé / nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",        
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // kartografové
        "ZP2015_ENTITY_ROLE_33",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
		// geografický objekt související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_71"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_028_02 Povinné role entit pro Štočky v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_STO") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
	// Rodic je INV 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// geografický objekt související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_71"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_028_03 Povinné role entit pro Štočky v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_STO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // vydavatelé / nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",        
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // kartografové
        "ZP2015_ENTITY_ROLE_33",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
		// geografický objekt související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_71"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end


rule "RE_028_04 Doporučené role entit pro Štočky v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_STO") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
        ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Cenné papíry
//----------------------------------------------

rule "Povinnost prvku pro cenné papíry v inv (jednotlivost)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_CPA") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
	// Rodic je INV nebo KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
	$itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro cenné papíry v inv (část jednotlivosti)"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_CPA") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je INV nebo KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
	$itemType.setType(RulItemType.Type.RECOMMENDED);
end

rule "Povinnost prvku pro cenné papíry v kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_CPA") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je INV nebo KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
	$itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_027 Cenné papíry
rule "RE_027_01 Možné role entit pro cenné papíry (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_CPA") ) from $ownItems
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in (
		// vydavatelé 
		"ZP2015_ENTITY_ROLE_15",
		// držitelé
		"ZP2015_ENTITY_ROLE_23",		
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
		// tiskárna/tiskař
		"ZP2015_ENTITY_ROLE_52",
		// místa vydání
		"ZP2015_ENTITY_ROLE_58",
		// místa vzniku předloh popisovaných kopií
		"ZP2015_ENTITY_ROLE_62"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_027_02 Povinné role entit pro cenné papíry v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_CPA") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
	// Rodic je INV 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// vydavatelé 
		"ZP2015_ENTITY_ROLE_15"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_027_03 Doporučené role entit pro cenné papíry v INV (část jednotlivosti)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_CPA") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je INV 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// vydavatelé 
		"ZP2015_ENTITY_ROLE_15"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_027_04 Povinné role entit pro cenné papíry v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_CPA") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// vydavatelé 
		"ZP2015_ENTITY_ROLE_15",
		// držitelé
		"ZP2015_ENTITY_ROLE_23",		
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
		// tiskárna/tiskař
		"ZP2015_ENTITY_ROLE_52",
		// místa vydání
		"ZP2015_ENTITY_ROLE_58"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_027_05 Doporučené role entit pro cenné papíry v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
	DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_CPA") ) from $ownItems
	DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
	// Rodic je KAT 
	Level( $items: descItems ) 
	DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
	// nastaveni prvku	
	$itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
	$itemSpec: RulItemSpecExt( code in ( 
		// místa vzniku předloh popisovaných kopií
		"ZP2015_ENTITY_ROLE_62"
	 ) ) from $itemType.rulItemSpecList
then
	$itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Faleristické předměty
//----------------------------------------------

rule "Povolení vybraných jiných datací (ZP2015_DATE_OTHER) pro předmět faler povahy"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    $itemType : RulItemTypeExt(code == "ZP2015_DATE_OTHER")
    $itemSpec : RulItemSpecExt(code in ("ZP2015_DATE_AWARDING",
    	"ZP2015_DATE_AWARD_CER", "ZP2015_DATE_WITHDRAWAL")) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Povinnost prvku pro Faleristické předměty v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV nebo KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Povinnost prvku pro Faleristické předměty v kat"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_030 Faleristické předměty
rule "RE_030_01 Možné role entit pro Faleristické předměty (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // nositel státního vyznamenání / ceny
        "ZP2015_ENTITY_ROLE_74",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa vydavatelů
        "ZP2015_ENTITY_ROLE_57",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // navrhovatel
        "ZP2015_ENTITY_ROLE_75",
        // předávající
        "ZP2015_ENTITY_ROLE_76",
        // místo předání
        "ZP2015_ENTITY_ROLE_88"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_030_02 Povinné role entit pro Faleristické předměty v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    Level( $items: descItems ) 
    not(DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $items)
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15"      
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_030_03 Doporučené role entit pro Faleristické předměty v INV (jednotlivost)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM") ) from $ownItems
    // Rodic je INV
    Level( $items: descItems ) 
    not(DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $items)
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // nositel státního vyznamenání / ceny
        "ZP2015_ENTITY_ROLE_74"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_030_04 Povinné role entit pro Faleristické předměty v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    not(DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $items)
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // nositel státního vyznamenání / ceny
        "ZP2015_ENTITY_ROLE_74",      
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa vydavatelů
        "ZP2015_ENTITY_ROLE_57",
        // navrhovatel
        "ZP2015_ENTITY_ROLE_75",
        // předávající
        "ZP2015_ENTITY_ROLE_76",
        // místo předání
        "ZP2015_ENTITY_ROLE_88"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_030_05 Doporučené role entit pro Faleristické předměty v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PFP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    not(DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $items)
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//-----------------
// Státní vyznamenání
//-----------------

rule "Možné prvky pro podtyp státní vyznamenání (vždy)"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $items
    $itemType: RulItemTypeExt( code in (
    	"ZP2015_AWARD_LEVEL",
    	"ZP2015_AWARD_GROUP",
        "ZP2015_DATE_OTHER",
        "ZP2015_OTHER_ID"
       ) )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Doporučené prvky pro podtyp vyznamenání (inventář, katalog)"
salience -100
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $items
    // Rodic je INV
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    $itemType: RulItemTypeExt( code in (
    	"ZP2015_AWARD_LEVEL",
    	"ZP2015_AWARD_GROUP",
        "ZP2015_DATE_OTHER",
        "ZP2015_OTHER_ID"
       ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end


rule "Doporučené specifikace pro podtyp vyznamenání"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $items
    $itemType: RulItemTypeExt( code in (
        "ZP2015_DATE_OTHER",
        "ZP2015_OTHER_ID"))
    $itemSpec: RulItemSpecExt( code in ( 
        "ZP2015_OTHERID_MATRIXID",
        "ZP2015_DATE_AWARDING"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.RECOMMENDED);
end


rule "Možné specifikace pro podtyp vyznamenání"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $items
    $itemType: RulItemTypeExt( code in (
    	"ZP2015_AWARD_LEVEL", 
        "ZP2015_DATE_OTHER"
       ) )
    $itemSpec: RulItemSpecExt( code in ( 
        "ZP2015_AWARD_LEVEL_CLASS",
        "ZP2015_AWARD_LEVEL_DEGREE",         
        "ZP2015_DATE_AWARD_CER",
        "ZP2015_DATE_WITHDRAWAL"       
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

// RE_031 Vyznamenání/cena
rule "RE_031_01 Možné role entit pro vyznamenání (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa vydavatelů
        "ZP2015_ENTITY_ROLE_57",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // státní vyznamenání / cena
        "ZP2015_ENTITY_ROLE_73",
        // nositel státního vyznamenání / ceny
        "ZP2015_ENTITY_ROLE_74",      
        // navrhovatel
        "ZP2015_ENTITY_ROLE_75",
        // předávající
        "ZP2015_ENTITY_ROLE_76",
        // místo předání
        "ZP2015_ENTITY_ROLE_88"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_031_02 Doporučené role entit pro vyznamenání (inventář, katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    // Rodic je INV
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // nositel státního vyznamenání / ceny
        "ZP2015_ENTITY_ROLE_74"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_031_03 Doporučené role entit pro vyznamenání (katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    // Rodic je INV
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // místo předání
        "ZP2015_ENTITY_ROLE_88"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_031_04 Povinné role entit pro vyznamenání (inventář)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // státní vyznamenání / cena
        "ZP2015_ENTITY_ROLE_73",
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_031_05 Povinné role entit pro vyznamenání (katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    // Rodic je KAT
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STV") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa vydavatelů
        "ZP2015_ENTITY_ROLE_57",
        // státní vyznamenání / cena
        "ZP2015_ENTITY_ROLE_73"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

//----------------------------------------------
// Numizmatické předměty
//----------------------------------------------

rule "Povinnost prvku pro Numizmatické předměty v inv a kat"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PNP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

// RE_029 Numizmatické předměty
rule "RE_029_01 Možné role entit pro Numizmatické předměty (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PNP") ) from $ownItems    
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",        
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa výroby jednotek popisu
        "ZP2015_ENTITY_ROLE_60",
        // místa vydavatelů
        "ZP2015_ENTITY_ROLE_57",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_029_02 Povinné role entit pro Numizmatické předměty v INV"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PNP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_029_03 Povinné role entit pro Numizmatické předměty v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PNP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",        
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // místa výroby jednotek popisu
        "ZP2015_ENTITY_ROLE_60",
        // místa vydavatelů
        "ZP2015_ENTITY_ROLE_57"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end


rule "RE_029_04 Doporučené role entit pro Numizmatické předměty v KAT"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_PNP") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in ( 
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

//----------------------------------------------
// Jiné jednotlivosti
//----------------------------------------------

// RE_006 Typ archiválie Jiná - všechny role entit volitelné
rule "RE_006 Typ archiválie Jiná - všechny role entit volitelné"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_JIN") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

rule "Povinnost prvku pro jiné jednotlivosti v KAT"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_JIN") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV nebo KAT 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end


//----------------------------------
// Neevidovaná jednotlivost
//----------------------------------

rule "Možné prvky popisu pro neevidované jednotlivosti (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_OTHER") ) from $ownItems
    $itemType: RulItemTypeExt( code in (
      // ZP5.2.2 Název autorského díla
      "ZP2015_ITEM_TITLE_REF"
    ) )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end


// Pridano na zaklade: https://bugzilla.lightcomp.cz/show_bug.cgi?id=6173
rule "Možné prvky popisu pro neevidované jednotlivosti ve starší pomůcce"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_OTHER") ) from $ownItems
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_OTHER") ) from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_IMPRINT_COUNT" ) )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Možné jiné datace pro neevidované jednotlivosti a část jednotlivosti."
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_OTHER", "ZP2015_UNIT_TYPE_PART") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_DATE_OTHER" ) )
    $itemSpec: RulItemSpecExt( code in ( "ZP2015_DATE_LEGALLY_EFFECTIVE_FROM",
                                         "ZP2015_DATE_VALID_FROM",
                                         "ZP2015_DATE_LEGALLY_EFFECTIVE_TO",
                                         "ZP2015_DATE_VALID_TO"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end


//
// RE_007 Typ archiválie Neevidovaná jednotlivost a Část jednotlivosti (bez hudebnin)
//
rule "RE_007 Typ archiválie Neevidovaná jednotlivost a Část jednotlivosti"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    $descItem : DescItem(type=="ZP2015_UNIT_TYPE" && specCode in ("ZP2015_UNIT_TYPE_OTHER", "ZP2015_UNIT_TYPE_PART") ) from $ownItems
    not DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_HDB") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // autor
        "ZP2015_ENTITY_ROLE_1",        
        // autoři textů
        "ZP2015_ENTITY_ROLE_11",        
        // vydavatelé
        "ZP2015_ENTITY_ROLE_15",
        // vydavatelé / nakladatelé
        "ZP2015_ENTITY_ROLE_16",
        // pečetitelé
        "ZP2015_ENTITY_ROLE_17",
        // objednatel
        "ZP2015_ENTITY_ROLE_19",
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // žadatelé
        "ZP2015_ENTITY_ROLE_22",
        // odesilatelé
        "ZP2015_ENTITY_ROLE_24",
        // schvalovatel
        "ZP2015_ENTITY_ROLE_25",
        // stavitelé
        "ZP2015_ENTITY_ROLE_26",        
        // fotografové
        "ZP2015_ENTITY_ROLE_31",
        // redaktor
        "ZP2015_ENTITY_ROLE_32",        
        // editor
        "ZP2015_ENTITY_ROLE_34",
        // kreslič
        "ZP2015_ENTITY_ROLE_36",        
        // tvůrce technické stránky
        "ZP2015_ENTITY_ROLE_38",        
        // tvůrce výtvarné stránky
        "ZP2015_ENTITY_ROLE_39",        
        // překladatelé
        "ZP2015_ENTITY_ROLE_44",
        // písaři
        "ZP2015_ENTITY_ROLE_48",
        // výrobci nosičů záznamů
        "ZP2015_ENTITY_ROLE_50",
        // tiskárny/tiskaři
        "ZP2015_ENTITY_ROLE_52",
        // místa vydání
        "ZP2015_ENTITY_ROLE_58",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // typové označení a název výrobku a typové stavby
        "ZP2015_ENTITY_ROLE_63",
        // navrhovatel
        "ZP2015_ENTITY_ROLE_75",
        // předávající
        "ZP2015_ENTITY_ROLE_76",
        // katalogizační záznam
        "ZP2015_ENTITY_ROLE_81",
        // opisovač
        "ZP2015_ENTITY_ROLE_84",
        // vlastník
        "ZP2015_ENTITY_ROLE_85",
        // místo předání
        "ZP2015_ENTITY_ROLE_88"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

//------------------------------
// Podtyp právní akt
//------------------------------

rule "Povinné prvky pro podtyp právní akt"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_PA") ) from $items
    $itemType: RulItemTypeExt( code in (
        "ZP2015_ENTITY_ROLE",
        "ZP2015_LEGALACT_REF"
       ) )    
then
    $itemType.setType(RulItemType.Type.REQUIRED);
    $itemType.setRepeatable(true);
end

// RE_033 Právní akt
rule "RE_033_01 Povinné role entit pro právní akt"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_PA") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // příjemci
        "ZP2015_ENTITY_ROLE_21"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_033_02 Povinné role entit pro právní akt (katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    // Rodic je KAT
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_PA") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatel
        "ZP2015_ENTITY_ROLE_15"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

//------------------------------
// Podtyp udělení vyznamenání
//------------------------------

rule "Povinnost prvku pro jiné jednotlivosti v INV"
no-loop
salience -100
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // Rodic je INV 
    $level: Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE", 
    									"ZP2015_DATE_OTHER") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "Doporučené prvky pro podtyp udělení vyznamenání (vždy)"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $items
    $itemType: RulItemTypeExt( code in (
    	"ZP2015_AWARD_LEVEL",
    	"ZP2015_AWARD_GROUP",        
        "ZP2015_OTHER_ID"
       ) )
then
    $itemType.setType(RulItemType.Type.POSSIBLE);
end

rule "Doporučené prvky pro podtyp udělení vyznamenání (inventář, katalog)"
salience -100
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $items
    // Rodic je INV
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    $itemType: RulItemTypeExt( code in (
    	"ZP2015_AWARD_LEVEL",
    	"ZP2015_AWARD_GROUP",
    	"ZP2015_OTHER_ID"
       ) )
then
    $itemType.setType(RulItemType.Type.RECOMMENDED);
end


rule "Povinné specifikace pro podtyp udělení vyznamenání"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $items    
    $itemType: RulItemTypeExt( code in (
        "ZP2015_DATE_OTHER"))
    $itemSpec: RulItemSpecExt( code in ( 
        "ZP2015_DATE_AWARDING"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "Doporučené specifikace pro podtyp udělení vyznamenání"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $items    
    $itemType: RulItemTypeExt( code in (
        "ZP2015_DATE_OTHER",
        "ZP2015_OTHER_ID"))
    $itemSpec: RulItemSpecExt( code in ( 
        "ZP2015_OTHERID_MATRIXID",
        "ZP2015_DATE_AWARD_CER"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.RECOMMENDED);
end


rule "Možné specifikace pro podtyp udělení vyznamenání"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $items
    $itemType: RulItemTypeExt( code in (
    	"ZP2015_AWARD_LEVEL", 
        "ZP2015_DATE_OTHER"
       ) )
    $itemSpec: RulItemSpecExt( code in ( 
        "ZP2015_AWARD_LEVEL_CLASS",
        "ZP2015_AWARD_LEVEL_DEGREE",
        "ZP2015_DATE_WITHDRAWAL"       
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.POSSIBLE);
end

// RE_032 Udělení/propůjčení vyznamenání/ceny
rule "RE_032_01 Možné role entit pro udělení vyznamenání (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // nositel státního vyznamenání / ceny
        "ZP2015_ENTITY_ROLE_74",
        // navrhovatel
        "ZP2015_ENTITY_ROLE_75",
        // předávající
        "ZP2015_ENTITY_ROLE_76"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_032_02 Doporučené role entit pro udělení vyznamenání (inventář, katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    // Rodic je INV a KAT
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // navrhovatel
        "ZP2015_ENTITY_ROLE_75",
        // předávající
        "ZP2015_ENTITY_ROLE_76",
        // místo předání
        "ZP2015_ENTITY_ROLE_88"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_032_03 Povinné role entit pro udělení vyznamenání (inventář, katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    // Rodic je INV
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // státní vyznamenání / cena
        "ZP2015_ENTITY_ROLE_73",
        // nositel státního vyznamenání / ceny
        "ZP2015_ENTITY_ROLE_74"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_032_04 Povinné role entit pro udělení vyznamenání (katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    // Rodic je KAT
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_STVR") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatel
        "ZP2015_ENTITY_ROLE_15"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end


//--------------------------------------
// jmenování nebo ustanovení do funkce
//--------------------------------------

// RE_034 Jmenování/ustanovení do funkce
rule "RE_034_01 Povinnost prvku pro jmenování nebo ustanovení do funkce"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_JMF") ) from $ownItems
    DescItem(type=="ZP2015_LEVEL_TYPE" && specCode in ("ZP2015_LEVEL_ITEM", "ZP2015_LEVEL_PART") ) from $ownItems
    // nastaveni prvku  
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE") )
then
    $itemType.setType(RulItemType.Type.REQUIRED);
end

rule "RE_034_02 Možné role entit pro jmenování nebo ustanovení do funkce (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_JMF") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatel
        "ZP2015_ENTITY_ROLE_15"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_034_03 Povinné role entit pro jmenování nebo ustanovení do funkce (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_JMF") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // osoba jmenovaná / ustanovená do funkce
        "ZP2015_ENTITY_ROLE_77",
        // funkce
        "ZP2015_ENTITY_ROLE_78",
        // korporace výkonu funkce
        "ZP2015_ENTITY_ROLE_79",
        // místo výkonu funkce
        "ZP2015_ENTITY_ROLE_80"        
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

rule "RE_034_04 Povinné role entit pro jmenování nebo ustanovení do funkce (katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    // Rodic je KAT
    Level( $items: descItems ) 
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_JMF") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // vydavatel
        "ZP2015_ENTITY_ROLE_15"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setType(RulItemSpec.Type.REQUIRED);
end

//-------------------------------
// Podtyp technická dokumentace
//-------------------------------

rule "Možné prvky pro podtyp technická dokumentace (vždy)"
no-loop
when $activeLevel: ActiveLevel( $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_TD") ) from $items
    $itemType: RulItemTypeExt( code in (
    	"ZP2015_POSITION"
       ) )
then
    $itemType.setMinType(RulItemType.Type.POSSIBLE);
end

rule "Doporučené prvky pro podtyp technická dokumentace (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems && $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_TD") ) from $ownItems
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE", 
//    									"ZP2015_DOCUMENTATION_TYPE",
    									"ZP2015_PART") )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end


// RE_035 Technická dokumentace
rule "RE_035_01 Možné role entit pro technickou dokumentaci (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_TD") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // objednatelé/příjemci 
        "ZP2015_ENTITY_ROLE_19",
        // autor
        "ZP2015_ENTITY_ROLE_1",
        // schvalovatelé
        "ZP2015_ENTITY_ROLE_25",
        // stavitelé
        "ZP2015_ENTITY_ROLE_26",
        // výrobci
        "ZP2015_ENTITY_ROLE_53",
        // kresliči
        "ZP2015_ENTITY_ROLE_36",
        // místa vzniku jednotek popisu
        "ZP2015_ENTITY_ROLE_61",
        // místa vzniku předloh popisovaných kopií
        "ZP2015_ENTITY_ROLE_62",
        // typová označení a názvy výrobků a typových staveb
        "ZP2015_ENTITY_ROLE_63"
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "RE_035_02 Doporučené role entit pro technickou dokumentaci (inventář, katalog)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems && $items: descItems )
    // Rodic je INV a KAT
    DescItem(type=="ZP2015_ARRANGEMENT_TYPE" && specCode in ("ZP2015_ARRANGEMENT_INV", "ZP2015_ARRANGEMENT_KAT")) from $items
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_TD") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // objednatelé/příjemci 
        "ZP2015_ENTITY_ROLE_19",
        // autor
        "ZP2015_ENTITY_ROLE_1",
        // typová označení a názvy výrobků a typových staveb
        "ZP2015_ENTITY_ROLE_63",
		// dílo/výtvor související s jednotkami popisu
		"ZP2015_ENTITY_ROLE_70"        
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end


//-------------------------------
// Podtyp korespondence
//-------------------------------

rule "Doporučené prvky pro podtyp korespondence (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems && $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_KOR") ) from $ownItems
    // nastaveni prvku
    $itemType: RulItemTypeExt( code in ("ZP2015_ENTITY_ROLE",
    									"ZP2015_SIZE", "ZP2015_AMOUNT", "ZP2015_STORAGE_COND", "ZP2015_ITEM_MAT") )
then
    $itemType.setMinType(RulItemType.Type.RECOMMENDED);
end


rule "Mozne specifikace pro prvek Mnozstvi v podtypu korespondence"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems && $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_KOR") ) from $ownItems
    $itemType : RulItemTypeExt(code in ("ZP2015_AMOUNT") )
    $itemSpec : RulItemSpecExt(code in ("ZP2015_AMOUNT_PIECES", "ZP2015_AMOUNT_SHEETS", "ZP2015_AMOUNT_PAGES") ) from $itemType.rulItemSpecList
then
  $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "Doporucene specifikace pro prvek Mnozstvi v podtypu korespondence"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems && $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_KOR") ) from $ownItems
    not (DescItem(type=="ZP2015_AMOUNT") from $ownItems )
    $itemType : RulItemTypeExt(code in ("ZP2015_AMOUNT") )
    $itemSpec : RulItemSpecExt(code in ("ZP2015_AMOUNT_PIECES") ) from $itemType.rulItemSpecList
then
  $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end


rule "RE_036 Doporučené role entit pro korespondenci (vždy)"
no-loop
when $activeLevel: ActiveLevel( $ownItems: ownDescItems && $items: descItems )
    DescItem(type=="ZP2015_UNIT_SUBTYPE" && specCode in ("ZP2015_UNIT_SUBTYPE_KOR") ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code in (
        // příjemci
        "ZP2015_ENTITY_ROLE_21",
        // odesílatelé
        "ZP2015_ENTITY_ROLE_24"        
     ) ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.RECOMMENDED);
end


// 
// RE_004 Změna povinnosti role entit v důsledku existence na vyšší úrovni (dědičnost)
//
rule "RE_004 Změna povinnosti role entit v důsledku existence na vyšší úrovni (dědičnost) - specifikace"
no-loop
salience -200
when $activeLevel: ActiveLevel( )
    $level : Level( this!=$activeLevel && $ownItems: ownDescItems )
    $roleEntity: DescItem(type=="ZP2015_ENTITY_ROLE" ) from $ownItems
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
    $itemSpec: RulItemSpecExt( code==$roleEntity.specCode ) from $itemType.rulItemSpecList    
then
    $itemSpec.setTypeMax(RulItemSpec.Type.RECOMMENDED);
end

rule "RE_004 Změna povinnosti role entit v důsledku existence na vyšší úrovni (dědičnost) - prvek popisu"
no-loop
salience -300
when 
    $itemType: RulItemTypeExt( code in ( "ZP2015_ENTITY_ROLE" ) )
then
    $itemType.setTypeMaxFromSpecs();
end

// 
// PP_007 Změna povinnosti prvku popisu v důsledku existence na vyšší úrovni (dědičnost)
//
rule "PP_007_001 Změna povinnosti prvku Dochování v důsledku existence na vyšší úrovni (dědičnost)"
no-loop
salience -300
when  $activeLevel: ActiveLevel( )
    $level : Level( this!=$activeLevel && $ownItems: ownDescItems )
    // ZP5.2.3 Způsob a forma dochování
    DescItem(type=="ZP2015_STORAGE_COND" ) from $ownItems
    $itemType: RulItemTypeExt( code=="ZP2015_STORAGE_COND" )
then
    $itemType.setMaxType(RulItemType.Type.RECOMMENDED);
end

rule "PP_007_002 Změna povinnosti prvku Kvantita v důsledku existence na vyšší úrovni (dědičnost)"
no-loop
salience -300
when  $activeLevel: ActiveLevel( )
    $level : Level( this!=$activeLevel && $ownItems: ownDescItems )
    // ZP5.2.4 Rozměry, hmotnost, velikost, množství
    DescItem(type=="ZP2015_SIZE" ) from $ownItems
    $itemType: RulItemTypeExt( code=="ZP2015_SIZE" )
then
    $itemType.setMaxType(RulItemType.Type.RECOMMENDED);
end

rule "PP_007_003 Změna povinnosti prvku Měřítko v důsledku existence na vyšší úrovni (dědičnost)"
no-loop
salience -300
when  $activeLevel: ActiveLevel( )
    $level : Level( this!=$activeLevel && $ownItems: ownDescItems )
    // ZP5.2.5 Měřítko
    DescItem(type in ("ZP2015_SCALE", "ZP2015_SCALE_NUMERICAL") ) from $ownItems
    $itemType: RulItemTypeExt( code in ("ZP2015_SCALE", "ZP2015_SCALE_NUMERICAL") )
then
    $itemType.setMaxType(RulItemType.Type.RECOMMENDED);
end

rule "PP_007_004 Změna povinnosti prvku Technika záznamu v důsledku existence na vyšší úrovni (dědičnost)"
no-loop
salience -300
when  $activeLevel: ActiveLevel( )
    $level : Level( this!=$activeLevel && $ownItems: ownDescItems )
    // ZP5.2.8 Technika, adjustace, nosič a látka záznamu
    DescItem(type=="ZP2015_ITEM_MAT" ) from $ownItems
    $itemType: RulItemTypeExt( code=="ZP2015_ITEM_MAT" )
then
    $itemType.setMaxType(RulItemType.Type.RECOMMENDED);
end

rule "PP_008 Charakter poškození - specifikace"
no-loop
when $itemType: RulItemTypeExt( code in (
        // Charakter poškození
        "ZP2015_UNIT_DAMAGE_TYPE"
        ) )
     $itemSpec: RulItemSpecExt( ) from $itemType.rulItemSpecList
then
    $itemSpec.setMinType(RulItemSpec.Type.POSSIBLE);
end

rule "PP_009_001 Změna povinnosti prvků v důsledku existence zneplatněného záznamu"
no-loop
salience -300
when  $activeLevel: ActiveLevel( )
    // pokud je zneplatneny zaznam
    DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    $itemType: RulItemTypeExt( code not in ("ZP2015_STORAGE_ID", "ZP2015_AIP_ID") )
then
    $itemType.setMaxType(RulItemType.Type.RECOMMENDED);
end

rule "PP_009_002 Změna povinnosti prvků v důsledku existence zneplatněného záznamu"
no-loop
salience -300
when  $activeLevel: ActiveLevel( )
    // pokud je zneplatneny zaznam
    DescItem(type=="ZP2015_INVALID_RECORD") from $activeLevel.descItems
    $itemType: RulItemTypeExt( code in ("ZP2015_STORAGE_ID", "ZP2015_AIP_ID")  )
then
    $itemType.setMaxType(RulItemType.Type.POSSIBLE);
end
